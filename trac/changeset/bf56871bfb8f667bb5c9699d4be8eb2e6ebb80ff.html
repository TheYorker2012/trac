<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  

  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>
      Changeset bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff –
      The Yorker
    </title>
        <link rel="search" href="../search.html" />
        <link rel="prev" href="163a31104027312eacc355b02dd9f8f0d7ddeb52.html" title="Changeset 163a31104027312eacc355b02dd9f8f0d7ddeb52" />
        <link rel="last" href="4663e7077f9a41a86111194402f498613109bfa4.html" title="Changeset 4663e7077f9a41a86111194402f498613109bfa4" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff?format=diff&new=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff" type="text/plain" class="diff" title="Unified Diff" /><link rel="alternate" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff?format=zip&new=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff" type="application/zip" class="zip" title="Zip Archive" />
        <link rel="next" href="be9b9936776a820d43634a647fc555a60fc9b1b1.html" title="Changeset be9b9936776a820d43634a647fc555a60fc9b1b1" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/changeset.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/diff.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/code.css" type="text/css" />
        <link rel="first" href="8f01cfef778eb063e661839b60a7226601ef07b1.html" title="Changeset 8f01cfef778eb063e661839b60a7226601ef07b1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search The Yorker" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/diff.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("li.entry h2 a").parent().addAnchor("Link to this diff");
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="../../trac.html"><img src="../../apps-logo.png" alt="The Yorker" /></a>
      </div>
      <form id="search" action="/trac/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first">logged in as nick_evans</li><li><a href="../../trac.html">Logout</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../browser.html">Browse Source</a></li><li><a href="../report.html">View Tickets</a></li><li><a href="../newticket.html">New Ticket</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
            <li class="first "><span>&larr; <a class="prev" href="163a31104027312eacc355b02dd9f8f0d7ddeb52.html" title="Changeset 163a31104027312eacc355b02dd9f8f0d7ddeb52">Previous Changeset</a></span></li><li class="last"><span><a class="next" href="be9b9936776a820d43634a647fc555a60fc9b1b1.html" title="Changeset be9b9936776a820d43634a647fc555a60fc9b1b1">Next Changeset</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="changeset">
      <div id="title">
        <h1>Changeset bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff</h1>
      </div>
      <form id="prefs" action="">
        <div>
    <label for="style">View differences</label>
    <select id="style" name="style">
      <option selected="selected" value="inline">inline</option>
      <option value="sidebyside">side by side</option>
    </select>
    <div class="field">
      Show <input type="text" name="contextlines" id="contextlines" size="2" maxlength="3" value="2" />
      <label for="contextlines">lines around each change</label>
    </div>
    <fieldset id="ignore">
      <legend>Ignore:</legend>
      <div class="field">
        <input type="checkbox" id="ignoreblanklines" name="ignoreblanklines" />
        <label for="ignoreblanklines">Blank lines</label>
      </div>
      <div class="field">
        <input type="checkbox" id="ignorecase" name="ignorecase" />
        <label for="ignorecase">Case changes</label>
      </div>
      <div class="field">
        <input type="checkbox" id="ignorewhitespace" name="ignorewhitespace" />
        <label for="ignorewhitespace">White space changes</label>
      </div>
    </fieldset>
    <div class="buttons">
      <input type="submit" name="update" value="Update" />
    </div>
        </div>
      </form>
      <dl id="overview">
          <dt class="property time">Timestamp:</dt>
          <dd class="time">12/06/08 01:29:50 (<a class="timeline" href="http://dev2.theyorker.co.uk/trac/timeline?from=2008-12-06T01%3A29%3A50Z%2B0000&precision=second" title="2008-12-06T01:29:50Z+0000 in Timeline">7 years</a> ago)</dd>
          <dt class="property author">Author:</dt>
          <dd class="author">James Hogan &lt;james_hogan@…&gt;</dd>
              <dt class="property">Parents:</dt>
              <dd><a class="changeset" href="163a31104027312eacc355b02dd9f8f0d7ddeb52.html" title="Event submission to open calendars: basic submission interface with  ...">163a31104027312eacc355b02dd9f8f0d7ddeb52</a></dd>
              <dt class="property">Children:</dt>
              <dd><a class="changeset" href="be9b9936776a820d43634a647fc555a60fc9b1b1.html" title="Sends notification email to vip when event submitted to open calendar">be9b9936776a820d43634a647fc555a60fc9b1b1</a></dd>
              <dt class="property">git-committer:</dt>
              <dd>James Hogan &lt;james_hogan@theyorker.co.uk&gt; / 2008-12-06T01:29:50Z+0000</dd>
          <dt class="property message">Message:</dt>
          <dd class="message searchable">
            
            
              <p>
Implemented submission of events to open calendars, and notification, acceptance, rejection of submissions<br />
</p>

            
            
          </dd>
          <dt class="property location">Location:</dt>
          <dd class="searchable"><a href="http://dev2.theyorker.co.uk/trac/browser/system/application?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">system/application</a></dd>
        <dt class="property files">Files:</dt>
        <dd class="files">
          <div class="legend" id="file-legend">
            <dl>
              <dt class="mod"></dt><dd>6 modified</dd>
            </dl>
          </div>
          <br />
          <ul>
            <li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
              libraries/Calendar_backend.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff.html#file0">3 diffs</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_notifications.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
              libraries/Calendar_notifications.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff.html#file1">3 diffs</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
              libraries/Calendar_source_yorker.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff.html#file2">6 diffs</a>)
            </li><li>
              <!-- ignored change (maybe because of diff options or ignored prop.) -->
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="../browser/system/application/models/calendar/events_model.php-rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff.html">
              models/calendar/events_model.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff.html#file4">2 diffs</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
              models/subcontrollers/calendar_subcontroller.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff.html#file5">4 diffs</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
              views/calendar/event.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff.html#file6">2 diffs</a>)
            </li>
          </ul>
        </dd>
      </dl>
      <div class="diff">
        <div class="legend" id="diff-legend">
          <h3>Legend:</h3>
          <dl>
            <dt class="unmod"></dt><dd>Unmodified</dd>
            <dt class="add"></dt><dd>Added</dd>
            <dt class="rem"></dt><dd>Removed</dd>
          </dl>
        </div>
        <div class="diff">
  <ul class="entries">
      <li class="entry">
        <h2 id="file0">
          <a title="Show the changeset bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff restricted to system/application/libraries/Calendar_backend.php" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff/system/application/libraries/Calendar_backend.php">system/application/libraries/Calendar_backend.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 163a31104027312eacc355b02dd9f8f0d7ddeb52">
                    <a title="Show revision 163a31104027312eacc355b02dd9f8f0d7ddeb52 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L160">
                      r163a3</a>
                  </th>
                  <th title="Revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
                    <a title="Show revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L160">
                      rbf568</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>160</th><th>160</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// string,NULL Description of location.</span> </td>
                  </tr><tr>
                          <th>161</th><th>161</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; public $LocationDescription&nbsp; &nbsp; &nbsp;= NULL;</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>162</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// array[&amp;CalendarOrganisation<del>] Array of owner organisation references</del>.</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>162</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// array[&amp;CalendarOrganisation<ins>&nbsp;=&gt; Bool] Array of owner organisation references and whether confirmed</ins>.</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>163</th><th>163</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; public $Organisations&nbsp; &nbsp;= array();</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>164</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// array[&amp;CalendarOrganisation =&gt; Bool] Array of subscribing organisation references and whether confirmed.</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>165</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; public $Subscribers&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= array();</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>164</th><th>166</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// timestamp,NULL Time of last significant updaate to the event.</span> </td>
                  </tr><tr>
                          <th>165</th><th>167</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; public $LastUpdate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = NULL;</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L187">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L189">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>187</th><th>189</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /**</span> </td>
                  </tr><tr>
                          <th>188</th><th>190</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $Organisation &amp;CalendarOrganisation Reference to organisation.</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>189</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span> </td>
                      </tr><tr>
                        <th>190</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; function AddOrganisation(&amp;$Organisation)</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>191</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $Confirmed bool Whether the organisation has confirmed.</span> </td>
                      </tr><tr>
                        <th> </th><th>192</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>193</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; function AddOrganisation(&amp;$Organisation, $Confirmed = true)</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>191</th><th>194</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                  </tr><tr>
                          <th>192</th><th>195</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // If the event already has this organisation, don't add again.</span> </td>
                  </tr><tr>
                          <th>193</th><th>196</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($this-&gt;Organisations as $org) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>194</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($org<del></del>-&gt;OrganisationId === $Organisation-&gt;OrganisationId) {</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>197</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($org<ins>['org']</ins>-&gt;OrganisationId === $Organisation-&gt;OrganisationId) {</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>195</th><th>198</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span> </td>
                  </tr><tr>
                          <th>196</th><th>199</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>197</th><th>200</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>198</th><th>201</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Add to end.</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>199</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;Organisations[] = &amp;$Organisation;</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>202</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;Organisations[] = array(</span> </td>
                      </tr><tr>
                        <th> </th><th>203</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'org' =&gt; &amp;$Organisation,</span> </td>
                      </tr><tr>
                        <th> </th><th>204</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'confirmed' =&gt; $Confirmed,</span> </td>
                      </tr><tr>
                        <th> </th><th>205</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>206</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>207</th><td class="r"><span></span> </td>
                      </tr><tr>
                        <th> </th><th>208</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Add an organisation to the organisations subscribed to an event.</span> </td>
                      </tr><tr>
                        <th> </th><th>209</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /**</span> </td>
                      </tr><tr>
                        <th> </th><th>210</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $Organisation &amp;CalendarOrganisation Reference to organisation.</span> </td>
                      </tr><tr>
                        <th> </th><th>211</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $Confirmed bool Whether the organisation has confirmed.</span> </td>
                      </tr><tr>
                        <th> </th><th>212</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span> </td>
                      </tr><tr>
                        <th> </th><th>213</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; function AddSubscriber(&amp;$Organisation, $Confirmed = true)</span> </td>
                      </tr><tr>
                        <th> </th><th>214</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                      </tr><tr>
                        <th> </th><th>215</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // If the event already has this organisation, don't add again.</span> </td>
                      </tr><tr>
                        <th> </th><th>216</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($this-&gt;Subscribers as $org) {</span> </td>
                      </tr><tr>
                        <th> </th><th>217</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($org['org']-&gt;OrganisationId === $Organisation-&gt;OrganisationId) {</span> </td>
                      </tr><tr>
                        <th> </th><th>218</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span> </td>
                      </tr><tr>
                        <th> </th><th>219</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>220</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>221</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Add to end.</span> </td>
                      </tr><tr>
                        <th> </th><th>222</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;Subscribers[] = array(</span> </td>
                      </tr><tr>
                        <th> </th><th>223</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'org' =&gt; &amp;$Organisation,</span> </td>
                      </tr><tr>
                        <th> </th><th>224</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'confirmed' =&gt; $Confirmed,</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>225</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>200</th><th>226</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>201</th><th>227</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L747">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L773">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>747</th><th>773</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -2 =&gt; array('summary' =&gt; 'Permission denied'),</span> </td>
                  </tr><tr>
                          <th>748</th><th>774</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>775</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($error_descriptions[$ErrorCode])) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>776</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $error_descriptions[$ErrorCode];</ins> </td>
                  </tr><tr>
                          <th> </th><th>777</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>778</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {</ins> </td>
                  </tr><tr>
                          <th> </th><th>779</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return array('summary' =&gt; 'Unrecognised error');</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>780</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>749</th><th>781</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>750</th><th>782</th><td class="l"><span>}</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file1">
          <a title="Show the changeset bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff restricted to system/application/libraries/Calendar_notifications.php" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff/system/application/libraries/Calendar_notifications.php">system/application/libraries/Calendar_notifications.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision ba82269a88abaaba184a04a7a9ba731fa2d737f9">
                    <a title="Show revision ba82269a88abaaba184a04a7a9ba731fa2d737f9 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_notifications.php?rev=ba82269a88abaaba184a04a7a9ba731fa2d737f9#L86">
                      rba822</a>
                  </th>
                  <th title="Revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
                    <a title="Show revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_notifications.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L86">
                      rbf568</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>86</th><th>86</th><td class="l"><span>Notifications::RegisterNotificationType(NotificationCancelledEvent::$notTypeInfo['id']);</span> </td>
                  </tr><tr>
                          <th>87</th><th>87</th><td class="l"><span></span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>88</th><td class="r"><ins>/// A notification for when an event is submitted to an open calendar.</ins> </td>
                  </tr><tr>
                          <th> </th><th>89</th><td class="r"><ins>class NotificationEventSubmission extends Notification</ins> </td>
                  </tr><tr>
                          <th> </th><th>90</th><td class="r"><ins>{</ins> </td>
                  </tr><tr>
                          <th> </th><th>91</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// The notification type information.</ins> </td>
                  </tr><tr>
                          <th> </th><th>92</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; public static $notTypeInfo = array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>93</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'id'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&gt; 'NotificationEventSubmission',</ins> </td>
                  </tr><tr>
                          <th> </th><th>94</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'class'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&gt; 'warning',</ins> </td>
                  </tr><tr>
                          <th> </th><th>95</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'summary'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&gt; 'Event Submission',</ins> </td>
                  </tr><tr>
                          <th> </th><th>96</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description'&nbsp; &nbsp;=&gt; 'An event has been submitted for inclusion on this calendar:',</ins> </td>
                  </tr><tr>
                          <th> </th><th>97</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'actions'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&gt; array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>98</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Accept'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&gt; 'Add the event to this calendar',</ins> </td>
                  </tr><tr>
                          <th> </th><th>99</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Reject'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&gt; 'Reject the event',</ins> </td>
                  </tr><tr>
                          <th> </th><th>100</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ),</ins> </td>
                  </tr><tr>
                          <th> </th><th>101</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; );</ins> </td>
                  </tr><tr>
                          <th> </th><th>102</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr><tr>
                          <th> </th><th>103</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// Default constructor</ins> </td>
                  </tr><tr>
                          <th> </th><th>104</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /**</ins> </td>
                  </tr><tr>
                          <th> </th><th>105</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $Keys array with keys 'userid', 'occid'.</ins> </td>
                  </tr><tr>
                          <th> </th><th>106</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</ins> </td>
                  </tr><tr>
                          <th> </th><th>107</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; function __construct($Keys, $Extra = NULL)</ins> </td>
                  </tr><tr>
                          <th> </th><th>108</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins> </td>
                  </tr><tr>
                          <th> </th><th>109</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; parent::__construct(self::$notTypeInfo, $Keys);</ins> </td>
                  </tr><tr>
                          <th> </th><th>110</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr><tr>
                          <th> </th><th>111</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL !== $Extra) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>112</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI = &amp; get_instance();</ins> </td>
                  </tr><tr>
                          <th> </th><th>113</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;SetData('Custom',</ins> </td>
                  </tr><tr>
                          <th> </th><th>114</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '&lt;p&gt;Summary: &lt;strong&gt;&lt;a href="'.site_url($Extra['link']). $CI-&gt;uri-&gt;uri_string().'"&gt;'.</ins> </td>
                  </tr><tr>
                          <th> </th><th>115</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xml_escape($Extra['name']).'&lt;/a&gt;&lt;/strong&gt;'</ins> </td>
                  </tr><tr>
                          <th> </th><th>116</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</ins> </td>
                  </tr><tr>
                          <th> </th><th>117</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>118</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>119</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr><tr>
                          <th> </th><th>120</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// Perform an action on this notification.</ins> </td>
                  </tr><tr>
                          <th> </th><th>121</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /**</ins> </td>
                  </tr><tr>
                          <th> </th><th>122</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @note The 'Dismiss' @a $Action sets the attendence to the occurrence to "no".</ins> </td>
                  </tr><tr>
                          <th> </th><th>123</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</ins> </td>
                  </tr><tr>
                          <th> </th><th>124</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; function PerformAction($Action)</ins> </td>
                  </tr><tr>
                          <th> </th><th>125</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins> </td>
                  </tr><tr>
                          <th> </th><th>126</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $messages = array();</ins> </td>
                  </tr><tr>
                          <th> </th><th>127</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI = &amp; get_instance();</ins> </td>
                  </tr><tr>
                          <th> </th><th>128</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $keys = $this-&gt;GetKeys();</ins> </td>
                  </tr><tr>
                          <th> </th><th>129</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch ($Action) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>130</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'Accept':</ins> </td>
                  </tr><tr>
                          <th> </th><th>131</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rows_affected = $CI-&gt;events_model-&gt;AcceptEventSubmission($keys['eventid']);</ins> </td>
                  </tr><tr>
                          <th> </th><th>132</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($rows_affected == 0) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>133</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI-&gt;messages-&gt;AddMessage('error', 'Submission could not be accepted.');</ins> </td>
                  </tr><tr>
                          <th> </th><th>134</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>135</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {</ins> </td>
                  </tr><tr>
                          <th> </th><th>136</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI-&gt;messages-&gt;AddMessage('success', 'Event has been added to calendar.');</ins> </td>
                  </tr><tr>
                          <th> </th><th>137</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>138</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</ins> </td>
                  </tr><tr>
                          <th> </th><th>139</th><td class="r"><ins></ins> </td>
                  </tr><tr>
                          <th> </th><th>140</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'Reject':</ins> </td>
                  </tr><tr>
                          <th> </th><th>141</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rows_affected = $CI-&gt;events_model-&gt;RejectEventSubmission($keys['eventid']);</ins> </td>
                  </tr><tr>
                          <th> </th><th>142</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($rows_affected == 0) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>143</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI-&gt;messages-&gt;AddMessage('error', 'Submission could not be rejected.');</ins> </td>
                  </tr><tr>
                          <th> </th><th>144</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>145</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {</ins> </td>
                  </tr><tr>
                          <th> </th><th>146</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI-&gt;messages-&gt;AddMessage('success', 'Submission has been rejected.');</ins> </td>
                  </tr><tr>
                          <th> </th><th>147</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>148</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</ins> </td>
                  </tr><tr>
                          <th> </th><th>149</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr><tr>
                          <th> </th><th>150</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:</ins> </td>
                  </tr><tr>
                          <th> </th><th>151</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $messages['error'][] = 'Invalid action on notification.';</ins> </td>
                  </tr><tr>
                          <th> </th><th>152</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</ins> </td>
                  </tr><tr>
                          <th> </th><th>153</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>154</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $messages;</ins> </td>
                  </tr><tr>
                          <th> </th><th>155</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>156</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>157</th><td class="r"><ins>// Register this notification type.</ins> </td>
                  </tr><tr>
                          <th> </th><th>158</th><td class="r"><ins>Notifications::RegisterNotificationType(NotificationEventSubmission::$notTypeInfo['id']);</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>159</th><td class="r"><ins></ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>88</th><th>160</th><td class="l"><span>/// Dummy class.</span> </td>
                  </tr><tr>
                          <th>89</th><th>161</th><td class="l"><span>class Calendar_notifications</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_notifications.php?rev=ba82269a88abaaba184a04a7a9ba731fa2d737f9#L93">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_notifications.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L165">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>93</th><th>165</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                  </tr><tr>
                          <th>94</th><th>166</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI = &amp; get_instance();</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>167</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $notifications = array();</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>168</th><td class="r"><ins></ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>95</th><th>169</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $occurrence_alerts = $CI-&gt;events_model-&gt;GetOccurrenceAlerts();</span> </td>
                  </tr>
            </tbody><tbody class="rem">
                  <tr class="last first">
                          <th>96</th><th> </th><td class="l"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $notifications = array();</del> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>97</th><th>170</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($occurrence_alerts as $occurrence) {</span> </td>
                  </tr><tr>
                          <th>98</th><th>171</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $occurrence['link'] = $paths-&gt;OccurrenceRawInfo(0, $occurrence['event_id'], $occurrence['occurrence_id']);</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_notifications.php?rev=ba82269a88abaaba184a04a7a9ba731fa2d737f9#L102">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_notifications.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L175">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>102</th><th>175</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ), $occurrence);</span> </td>
                  </tr><tr>
                          <th>103</th><th>176</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>177</th><td class="r"><ins></ins> </td>
                  </tr><tr>
                          <th> </th><th>178</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $event_submissions = $CI-&gt;events_model-&gt;GetEventSubmissions();</ins> </td>
                  </tr><tr>
                          <th> </th><th>179</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($event_submissions as $event_submission) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>180</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $event_submission['link'] = $paths-&gt;EventRawInfo(0, $event_submission['event_id']);</ins> </td>
                  </tr><tr>
                          <th> </th><th>181</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $notifications[] = Notifications::Create('NotificationEventSubmission', array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>182</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'userid' =&gt; $CI-&gt;events_model-&gt;GetActiveEntityId(),</ins> </td>
                  </tr><tr>
                          <th> </th><th>183</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'eventid' =&gt; $event_submission['event_id'],</ins> </td>
                  </tr><tr>
                          <th> </th><th>184</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ), $event_submission);</ins> </td>
                  </tr><tr>
                          <th> </th><th>185</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>186</th><td class="r"><ins></ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>104</th><th>187</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $notifications;</span> </td>
                  </tr><tr>
                          <th>105</th><th>188</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file2">
          <a title="Show the changeset bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff restricted to system/application/libraries/Calendar_source_yorker.php" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff/system/application/libraries/Calendar_source_yorker.php">system/application/libraries/Calendar_source_yorker.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 163a31104027312eacc355b02dd9f8f0d7ddeb52">
                    <a title="Show revision 163a31104027312eacc355b02dd9f8f0d7ddeb52 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L186">
                      r163a3</a>
                  </th>
                  <th title="Revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
                    <a title="Show revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L186">
                      rbf568</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>186</th><th>186</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;mQuery-&gt;ExpressionOwned().'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AS owned,'.</span> </td>
                  </tr><tr>
                          <th>187</th><th>187</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>188</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_entities.event_entity_confirmed&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AS org_confirmed,'.</ins> </td>
                  </tr><tr>
                          <th> </th><th>189</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_entities.event_entity_relationship&nbsp; &nbsp; &nbsp; &nbsp;AS org_relationship,'.</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>190</th><td class="r"><ins></ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>188</th><th>191</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'organisations.organisation_entity_id&nbsp; &nbsp;AS org_id,'.</span> </td>
                  </tr><tr>
                          <th>189</th><th>192</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'organisations.organisation_name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AS org_name,'.</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L354">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L357">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>354</th><th>357</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $organisation-&gt;ShortName = $row['org_shortname'];</span> </td>
                  </tr><tr>
                          <th>355</th><th>358</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>356</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $events[$event_id]-&gt;AddOrganisation($organisations[$org_id]);</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>359</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($row['org_relationship'] == 'subscribe') {</span> </td>
                      </tr><tr>
                        <th> </th><th>360</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $events[$event_id]-&gt;AddSubscriber($organisations[$org_id],</span> </td>
                      </tr><tr>
                        <th> </th><th>361</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 != $row['org_confirmed']);</span> </td>
                      </tr><tr>
                        <th> </th><th>362</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>363</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {</span> </td>
                      </tr><tr>
                        <th> </th><th>364</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $events[$event_id]-&gt;AddOrganisation($organisations[$org_id],</span> </td>
                      </tr><tr>
                        <th> </th><th>365</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL === $row['org_confirmed'] || 0 != $row['org_confirmed']);</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>366</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>357</th><th>367</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>358</th><th>368</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L367">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L377">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>367</th><th>377</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                  </tr><tr>
                          <th>368</th><th>378</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /// @todo Optimise main event query to avoid left joins amap</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="last first">
                          <th> </th><th>379</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // FIXME unconfirmed subscriptions will only show up to the primary owner, not secondary owners</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>369</th><th>380</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql = '</span> </td>
                  </tr><tr>
                          <th>370</th><th>381</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SELECT '.$Fields.' FROM event_occurrences</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L374">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L385">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>374</th><th>385</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN event_types</span> </td>
                  </tr><tr>
                          <th>375</th><th>386</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; events.event_type_id = event_types.event_type_id</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>387</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN event_entities AS event_entities_link</ins> </td>
                  </tr><tr>
                          <th> </th><th>388</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_entities_link.event_entity_event_id = events.event_id</ins> </td>
                  </tr><tr>
                          <th> </th><th>389</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;(&nbsp; &nbsp; &nbsp; &nbsp;event_entities_link.event_entity_confirmed = TRUE</ins> </td>
                  </tr><tr>
                          <th> </th><th>390</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OR&nbsp; &nbsp; &nbsp; event_organiser_entity_id&nbsp; &nbsp; &nbsp; &nbsp;= '.$this-&gt;mQuery-&gt;GetEntityId().')</ins> </td>
                  </tr><tr>
                          <th> </th><th>391</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN organisations</ins> </td>
                  </tr><tr>
                          <th> </th><th>392</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; organisations.organisation_entity_id</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>393</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IN (event_entities_link.event_entity_entity_id, events.event_organiser_entity_id)</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>376</th><th>394</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN event_entities</span> </td>
                  </tr><tr>
                          <th>377</th><th>395</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_entities.event_entity_event_id = events.event_id</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>378</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <del>LEFT JOIN organisations</del></span> </td>
                      </tr><tr>
                        <th>379</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <del>ON&nbsp; &nbsp; &nbsp; organisations.organisation_entity_id</del></span> </td>
                      </tr><tr>
                        <th>380</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IN (event_entities.event_entity_entity_id, events.event_organiser_entity_id)</del></span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>396</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <ins>&nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;(&nbsp; &nbsp; &nbsp; &nbsp;event_entities.event_entity_confirmed = TRUE</ins></span> </td>
                      </tr><tr>
                        <th> </th><th>397</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <ins>&nbsp; &nbsp; &nbsp; &nbsp; OR&nbsp; &nbsp; &nbsp; event_organiser_entity_id&nbsp; &nbsp; &nbsp; &nbsp;= '.$this-&gt;mQuery-&gt;GetEntityId().')</ins></span> </td>
                      </tr><tr class="last">
                        <th> </th><th>398</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <ins>AND&nbsp; &nbsp; &nbsp;event_entities.event_entity_entity_id = organisations.organisation_entity_id</ins></span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>381</th><th>399</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN event_subscriptions</span> </td>
                  </tr><tr>
                          <th>382</th><th>400</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_subscriptions.event_subscription_organisation_entity_id</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L558">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L576">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>558</th><th>576</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; function GetAllOpenCalendars()</span> </td>
                  </tr><tr>
                          <th>559</th><th>577</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>560</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return array(</span> </td>
                      </tr><tr>
                        <th>561</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 853 =&gt; array(</span> </td>
                      </tr><tr>
                        <th>562</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'name' =&gt; 'The Yorker Specials',</span> </td>
                      </tr><tr>
                        <th>563</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description_xml' =&gt; '&lt;p&gt;Events in The Yorker Specials are automatically visible on every user\'s calendar.&nbsp; It is meant for events of general interest to all University of York students.&lt;/p&gt;',</span> </td>
                      </tr><tr>
                        <th>564</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ),</span> </td>
                      </tr><tr>
                        <th>565</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 11 =&gt; array(</span> </td>
                      </tr><tr>
                        <th>566</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'name' =&gt; 'Derwent Events',</span> </td>
                      </tr><tr>
                        <th>567</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description_xml' =&gt; '&lt;p&gt;Events of general interest to students of Derwent college&lt;/p&gt;',</span> </td>
                      </tr><tr>
                        <th>568</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ),</span> </td>
                      </tr><tr>
                        <th>569</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>578</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql = 'SELECT `organisation_entity_id` AS entity_id,'</span> </td>
                      </tr><tr>
                        <th> </th><th>579</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; &nbsp; &nbsp;`organisation_name` AS name,'</span> </td>
                      </tr><tr>
                        <th> </th><th>580</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; &nbsp; &nbsp;`organisation_event_submission_text` AS text'</span> </td>
                      </tr><tr>
                        <th> </th><th>581</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. ' FROM&nbsp; `organisations`'</span> </td>
                      </tr><tr>
                        <th> </th><th>582</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. ' WHERE `organisation_events` = True'</span> </td>
                      </tr><tr>
                        <th> </th><th>583</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. ' AND&nbsp; &nbsp;`organisation_event_submission_text` IS NOT NULL'</span> </td>
                      </tr><tr>
                        <th> </th><th>584</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. ' ORDER BY `organisation_name` ASC';</span> </td>
                      </tr><tr>
                        <th> </th><th>585</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI = &amp; get_instance();</span> </td>
                      </tr><tr>
                        <th> </th><th>586</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $open_calendars = $CI-&gt;db-&gt;query($sql)-&gt;result_array();</span> </td>
                      </tr><tr>
                        <th> </th><th>587</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $result = array();</span> </td>
                      </tr><tr>
                        <th> </th><th>588</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($open_calendars as $row) {</span> </td>
                      </tr><tr>
                        <th> </th><th>589</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $result[(int)$row['entity_id']] = array(</span> </td>
                      </tr><tr>
                        <th> </th><th>590</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'id'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&gt; $row['entity_id'],</span> </td>
                      </tr><tr>
                        <th> </th><th>591</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'name'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&gt; $row['name'],</span> </td>
                      </tr><tr>
                        <th> </th><th>592</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description_xml' =&gt; '&lt;p&gt;'.xml_escape($row['text']).'&lt;/p&gt;',</span> </td>
                      </tr><tr>
                        <th> </th><th>593</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>594</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>595</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $result;</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>570</th><th>596</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>571</th><th>597</th><td class="l"><span></span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L578">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L604">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>578</th><th>604</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; function SubmitEventToCalendar(&amp; $Event, $Id)</span> </td>
                  </tr><tr>
                          <th>579</th><th>605</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>580</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -1;</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>606</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // This checks that the org is capable of receiving submissions</span> </td>
                      </tr><tr>
                        <th> </th><th>607</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // and that the event exists, but not that the event is visible or whatever</span> </td>
                      </tr><tr>
                        <th> </th><th>608</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql = 'INSERT INTO event_entities'</span> </td>
                      </tr><tr>
                        <th> </th><th>609</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; (`event_entity_entity_id`, `event_entity_event_id`, `event_entity_relationship`, `event_entity_confirmed`)'</span> </td>
                      </tr><tr>
                        <th> </th><th>610</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. ' SELECT `organisation_entity_id`, `event_id`, ?, ?'</span> </td>
                      </tr><tr>
                        <th> </th><th>611</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp;FROM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`organisations`, `events`'</span> </td>
                      </tr><tr>
                        <th> </th><th>612</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp;WHERE&nbsp; &nbsp; &nbsp; &nbsp; `organisation_entity_id` = ?'</span> </td>
                      </tr><tr>
                        <th> </th><th>613</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; &nbsp;AND&nbsp; &nbsp; &nbsp; &nbsp; `organisation_events` = True'</span> </td>
                      </tr><tr>
                        <th> </th><th>614</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; &nbsp;AND&nbsp; &nbsp; &nbsp; &nbsp; `organisation_event_submission_text` IS NOT NULL'</span> </td>
                      </tr><tr>
                        <th> </th><th>615</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; &nbsp;AND&nbsp; &nbsp; &nbsp; &nbsp; `event_id` = ?'</span> </td>
                      </tr><tr>
                        <th> </th><th>616</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp;LIMIT 1'</span> </td>
                      </tr><tr>
                        <th> </th><th>617</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. ' ON DUPLICATE KEY UPDATE `event_entity_confirmed`=`event_entity_confirmed`';</span> </td>
                      </tr><tr>
                        <th> </th><th>618</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $bind = array(</span> </td>
                      </tr><tr>
                        <th> </th><th>619</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'subscribe', false,</span> </td>
                      </tr><tr>
                        <th> </th><th>620</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Id, $Event-&gt;SourceEventId, </span> </td>
                      </tr><tr>
                        <th> </th><th>621</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>622</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI = &amp; get_instance();</span> </td>
                      </tr><tr>
                        <th> </th><th>623</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $query = $CI-&gt;db-&gt;query($sql, $bind);</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>624</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $CI-&gt;db-&gt;affected_rows();</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>581</th><th>625</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>582</th><th>626</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file4">
          <a title="Show the changeset bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff restricted to system/application/models/calendar/events_model.php" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff/system/application/models/calendar/events_model.php">system/application/models/calendar/events_model.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision cbe093de27d9c758fb124bb42ba7b837c5c85669">
                    <a title="Show revision cbe093de27d9c758fb124bb42ba7b837c5c85669 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=cbe093de27d9c758fb124bb42ba7b837c5c85669#L937">
                      rcbe09</a>
                  </th>
                  <th title="Revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
                    <a title="Show revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff of this file in browser" href="../browser/system/application/models/calendar/events_model.php-rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff.html#L937">
                      rbf568</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>937</th><th>937</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>938</th><th>938</th><td class="l"><span></span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>939</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// Get event submissions.</ins> </td>
                  </tr><tr>
                          <th> </th><th>940</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /**</ins> </td>
                  </tr><tr>
                          <th> </th><th>941</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @return array of event submissions:</ins> </td>
                  </tr><tr>
                          <th> </th><th>942</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - 'event_id'</ins> </td>
                  </tr><tr>
                          <th> </th><th>943</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - 'name'</ins> </td>
                  </tr><tr>
                          <th> </th><th>944</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</ins> </td>
                  </tr><tr>
                          <th> </th><th>945</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; function GetEventSubmissions()</ins> </td>
                  </tr><tr>
                          <th> </th><th>946</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins> </td>
                  </tr><tr>
                          <th> </th><th>947</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql = 'SELECT&nbsp; event_id&nbsp; &nbsp; &nbsp; &nbsp; AS event_id,'</ins> </td>
                  </tr><tr>
                          <th> </th><th>948</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_name&nbsp; &nbsp; &nbsp; AS name'</ins> </td>
                  </tr><tr>
                          <th> </th><th>949</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. ' FROM&nbsp; &nbsp;event_entities'</ins> </td>
                  </tr><tr>
                          <th> </th><th>950</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. ' INNER JOIN&nbsp; &nbsp; &nbsp;events'</ins> </td>
                  </tr><tr>
                          <th> </th><th>951</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_id = event_entity_event_id'</ins> </td>
                  </tr><tr>
                          <th> </th><th>952</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. ' WHERE&nbsp; event_entity_entity_id = '.$this-&gt;GetActiveEntityId()</ins> </td>
                  </tr><tr>
                          <th> </th><th>953</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_entity_relationship = "subscribe"'</ins> </td>
                  </tr><tr>
                          <th> </th><th>954</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_entity_confirmed = False'</ins> </td>
                  </tr><tr>
                          <th> </th><th>955</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. '&nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_deleted = False';</ins> </td>
                  </tr><tr>
                          <th> </th><th>956</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $query = $this-&gt;db-&gt;query($sql);</ins> </td>
                  </tr><tr>
                          <th> </th><th>957</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $query-&gt;result_array();</ins> </td>
                  </tr><tr>
                          <th> </th><th>958</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>959</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr><tr>
                          <th> </th><th>960</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// Accept an event submission.</ins> </td>
                  </tr><tr>
                          <th> </th><th>961</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; function AcceptEventSubmission($event_id)</ins> </td>
                  </tr><tr>
                          <th> </th><th>962</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins> </td>
                  </tr><tr>
                          <th> </th><th>963</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $occurrence_query = new EventOccurrenceQuery();</ins> </td>
                  </tr><tr>
                          <th> </th><th>964</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql = '</ins> </td>
                  </tr><tr>
                          <th> </th><th>965</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UPDATE&nbsp; event_entities</ins> </td>
                  </tr><tr>
                          <th> </th><th>966</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;event_entity_confirmed = TRUE</ins> </td>
                  </tr><tr>
                          <th> </th><th>967</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE&nbsp; &nbsp;event_entity_entity_id = '.$this-&gt;GetActiveEntityId().'</ins> </td>
                  </tr><tr>
                          <th> </th><th>968</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_entity_event_id = ?</ins> </td>
                  </tr><tr>
                          <th> </th><th>969</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_entity_relationship = "subscribe"</ins> </td>
                  </tr><tr>
                          <th> </th><th>970</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_entity_confirmed = FALSE';</ins> </td>
                  </tr><tr>
                          <th> </th><th>971</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;db-&gt;query($sql, array($event_id));</ins> </td>
                  </tr><tr>
                          <th> </th><th>972</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;db-&gt;affected_rows();</ins> </td>
                  </tr><tr>
                          <th> </th><th>973</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>974</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr><tr>
                          <th> </th><th>975</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// Reject an event submission.</ins> </td>
                  </tr><tr>
                          <th> </th><th>976</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; function RejectEventSubmission($event_id)</ins> </td>
                  </tr><tr>
                          <th> </th><th>977</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins> </td>
                  </tr><tr>
                          <th> </th><th>978</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $occurrence_query = new EventOccurrenceQuery();</ins> </td>
                  </tr><tr>
                          <th> </th><th>979</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql = '</ins> </td>
                  </tr><tr>
                          <th> </th><th>980</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DELETE FROM&nbsp; &nbsp; &nbsp;event_entities</ins> </td>
                  </tr><tr>
                          <th> </th><th>981</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE&nbsp; &nbsp;event_entity_entity_id = '.$this-&gt;GetActiveEntityId().'</ins> </td>
                  </tr><tr>
                          <th> </th><th>982</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_entity_event_id = ?</ins> </td>
                  </tr><tr>
                          <th> </th><th>983</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_entity_relationship = "subscribe"</ins> </td>
                  </tr><tr>
                          <th> </th><th>984</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_entity_confirmed = FALSE';</ins> </td>
                  </tr><tr>
                          <th> </th><th>985</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;db-&gt;query($sql, array($event_id));</ins> </td>
                  </tr><tr>
                          <th> </th><th>986</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;db-&gt;affected_rows();</ins> </td>
                  </tr><tr>
                          <th> </th><th>987</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>988</th><td class="r"><ins></ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>939</th><th>989</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Get occurrences which have changed so that the user needs informing.</span> </td>
                  </tr><tr>
                          <th>940</th><th>990</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /**</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=cbe093de27d9c758fb124bb42ba7b837c5c85669#L945">…</a></th>
                  <th><a href="../browser/system/application/models/calendar/events_model.php-rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff.html#L995">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>945</th><th>995</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - 'state'</span> </td>
                  </tr><tr>
                          <th>946</th><th>996</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - 'start_time'</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>947</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - '<del>start</del>_time'</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>997</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - '<ins>end</ins>_time'</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>948</th><th>998</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - 'time_associated'</span> </td>
                  </tr><tr>
                          <th>949</th><th>999</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file5">
          <a title="Show the changeset bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff restricted to system/application/models/subcontrollers/calendar_subcontroller.php" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff/system/application/models/subcontrollers/calendar_subcontroller.php">system/application/models/subcontrollers/calendar_subcontroller.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 163a31104027312eacc355b02dd9f8f0d7ddeb52">
                    <a title="Show revision 163a31104027312eacc355b02dd9f8f0d7ddeb52 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L169">
                      r163a3</a>
                  </th>
                  <th title="Revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
                    <a title="Show revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L169">
                      rbf568</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>169</th><th>169</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr><tr>
                          <th>170</th><th>170</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Get the event information path.</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>171</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; function Event<del>Info($Event</del>, $range = NULL, $filter = NULL)</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>171</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; function Event<ins>RawInfo($SourceId, $EventId</ins>, $range = NULL, $filter = NULL)</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>172</th><th>172</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                  </tr><tr>
                          <th>173</th><th>173</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;mPath .</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>174</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '/src/'.&nbsp; &nbsp; &nbsp; &nbsp; $Event-&gt;Source-&gt;GetSourceId().</span> </td>
                      </tr><tr>
                        <th>175</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '/event/'.&nbsp; &nbsp; &nbsp; $Event-&gt;SourceEventId.</span> </td>
                      </tr><tr>
                        <th>176</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '/info'.</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>174</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "/src/$SourceId/event/$EventId/info".</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>177</th><th>175</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '/'.(NULL !== $range&nbsp; ? $range&nbsp; : 'default').</span> </td>
                  </tr><tr>
                          <th>178</th><th>176</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '/'.(NULL !== $filter ? $filter : 'default');</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>177</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>178</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr><tr>
                          <th> </th><th>179</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// Get the event information path.</ins> </td>
                  </tr><tr>
                          <th> </th><th>180</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; function EventInfo($Event, $range = NULL, $filter = NULL)</ins> </td>
                  </tr><tr>
                          <th> </th><th>181</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins> </td>
                  </tr><tr>
                          <th> </th><th>182</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;EventRawInfo(</ins> </td>
                  </tr><tr>
                          <th> </th><th>183</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Event-&gt;Source-&gt;GetSourceId(),</ins> </td>
                  </tr><tr>
                          <th> </th><th>184</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Event-&gt;SourceEventId,</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>185</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $range, $filter);</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>179</th><th>186</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>180</th><th>187</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L1389">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L1396">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1389</th><th>1396</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1390</th><th>1397</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1398</th><td class="r"><ins></ins> </td>
                  </tr><tr>
                          <th> </th><th>1399</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Get the open calendars excluding any owners or subscribers</ins> </td>
                  </tr><tr>
                          <th> </th><th>1400</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $open_calendars = $this-&gt;mSource-&gt;GetAllOpenCalendars();</ins> </td>
                  </tr><tr>
                          <th> </th><th>1401</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($event-&gt;Organisations as $org) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>1402</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset($open_calendars[$org['org']-&gt;SourceOrganisationId]);</ins> </td>
                  </tr><tr>
                          <th> </th><th>1403</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>1404</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($event-&gt;Subscribers as $org) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>1405</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset($open_calendars[$org['org']-&gt;SourceOrganisationId]);</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1406</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1391</th><th>1407</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr><tr>
                          <th>1392</th><th>1408</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $data = array(</span> </td>
                  </tr><tr>
                          <th>1393</th><th>1409</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Event' =&gt; &amp;$event,</span> </td>
                  </tr><tr>
                          <th>1394</th><th>1410</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'ShowPublicity' =&gt; ($event-&gt;UserStatus == 'owner') &amp;&amp; isset($this-&gt;mPermissions['publicity']),</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1395</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'OpenCalendars' =&gt; $<del>this-&gt;mSource-&gt;GetAllOpenCalendars()</del>,</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1411</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'OpenCalendars' =&gt; $<ins>open_calendars</ins>,</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1396</th><th>1412</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'ReadOnly' =&gt; $this-&gt;mSource-&gt;IsSupported('create'),</span> </td>
                  </tr><tr>
                          <th>1397</th><th>1413</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'FailRedirect' =&gt; '/'.$tail,</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L1763">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L1779">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1763</th><th>1779</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1764</th><th>1780</th><td class="l"><span></span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1781</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Get the redirect url tail</ins> </td>
                  </tr><tr>
                          <th> </th><th>1782</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $args = func_get_args();</ins> </td>
                  </tr><tr>
                          <th> </th><th>1783</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tail = implode('/', $args);</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1784</th><td class="r"><ins></ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1765</th><th>1785</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Fetch the specified event</span> </td>
                  </tr><tr>
                          <th>1766</th><th>1786</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $calendar_data = new CalendarData();</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L1769">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L1789">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1769</th><th>1789</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (array_key_exists(0, $events)) {</span> </td>
                  </tr><tr>
                          <th>1770</th><th>1790</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $event = $events[0];</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="last first">
                          <th> </th><th>1791</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $redirect_path = $this-&gt;mPaths-&gt;EventInfo($event).'/'.$tail;</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1771</th><th>1792</th><td class="l"><span></span> </td>
                  </tr><tr>
                          <th>1772</th><th>1793</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Some of the event must be published</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1773</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // The calendar mustn't already be subscribed to the event</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1794</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $some_published = false;</span> </td>
                      </tr><tr>
                        <th> </th><th>1795</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($event-&gt;Occurrences as &amp;$occ) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1796</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($occ-&gt;State == 'published') {</span> </td>
                      </tr><tr>
                        <th> </th><th>1797</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $some_published = true;</span> </td>
                      </tr><tr>
                        <th> </th><th>1798</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr>
                        <th> </th><th>1799</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1800</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1801</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!$some_published) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1802</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('error', 'No occurrences of this event are yet published. You must publish the event before you can submit it to an open calendar.');</span> </td>
                      </tr><tr>
                        <th> </th><th>1803</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; redirect($redirect_path);</span> </td>
                      </tr><tr>
                        <th> </th><th>1804</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1805</th><td class="r"><span></span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1774</th><th>1806</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // The calendar must be valid and accept submissions</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1775</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th>1776</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Get the redirect url tail</span> </td>
                      </tr><tr>
                        <th>1777</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $args = func_get_args();</span> </td>
                      </tr><tr>
                        <th>1778</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tail = implode('/', $args);</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1807</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // We'll find this out when we try and submit</span> </td>
                      </tr><tr>
                        <th> </th><th>1808</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $calendarId = (int)$_POST['evview_open_calendar'];</span> </td>
                      </tr><tr>
                        <th> </th><th>1809</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $open_calendars = $this-&gt;mSource-&gt;GetAllOpenCalendars();</span> </td>
                      </tr><tr>
                        <th> </th><th>1810</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($event-&gt;Organisations as $org) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1811</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset($open_calendars[$org['org']-&gt;SourceOrganisationId]);</span> </td>
                      </tr><tr>
                        <th> </th><th>1812</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1813</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($event-&gt;Subscribers as $org) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1814</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset($open_calendars[$org['org']-&gt;SourceOrganisationId]);</span> </td>
                      </tr><tr>
                        <th> </th><th>1815</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1816</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!isset($open_calendars[$calendarId])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1817</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('error', 'The specified calendar is invalid or is not a calendar that this event can be submitted to.');</span> </td>
                      </tr><tr>
                        <th> </th><th>1818</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; redirect($redirect_path);</span> </td>
                      </tr><tr>
                        <th> </th><th>1819</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1820</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $result = $event-&gt;Source-&gt;SubmitEventToCalendar($event, $calendarId);</span> </td>
                      </tr><tr>
                        <th> </th><th>1821</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($result &lt; 0) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1822</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $error_description = $event-&gt;Source-&gt;GetErrorDescription($result);</span> </td>
                      </tr><tr>
                        <th> </th><th>1823</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('error', 'Could not submit this event to the specified calendar: '.xml_escape($error_description['summary']).'.');</span> </td>
                      </tr><tr>
                        <th> </th><th>1824</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; redirect($redirect_path);</span> </td>
                      </tr><tr>
                        <th> </th><th>1825</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1826</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if ($result == 0) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1827</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('information', 'This event has already been submitted to '.xml_escape($open_calendars[$calendarId]['name']).'.');</span> </td>
                      </tr><tr>
                        <th> </th><th>1828</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; redirect($redirect_path);</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1829</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1779</th><th>1830</th><td class="l"><span></span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1780</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('error', 'Nothing really happened!');</span> </td>
                      </tr><tr>
                        <th>1781</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; redirect($this-&gt;mPaths-&gt;EventInfo($event).'/'.$tail);</span> </td>
                      </tr><tr>
                        <th>1782</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1831</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('success', 'Event was successfully submitted to '.xml_escape($open_calendars[$calendarId]['name']).'.');</span> </td>
                      </tr><tr>
                        <th> </th><th>1832</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; redirect($redirect_path);</span> </td>
                      </tr><tr>
                        <th> </th><th>1833</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1834</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('error', 'Event not found!');</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1835</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; redirect($tail);</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1783</th><th>1836</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1784</th><th>1837</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file6">
          <a title="Show the changeset bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff restricted to system/application/views/calendar/event.php" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff/system/application/views/calendar/event.php">system/application/views/calendar/event.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 163a31104027312eacc355b02dd9f8f0d7ddeb52">
                    <a title="Show revision 163a31104027312eacc355b02dd9f8f0d7ddeb52 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L91">
                      r163a3</a>
                  </th>
                  <th title="Revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff">
                    <a title="Show revision bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L91">
                      rbf568</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>91</th><th>91</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo('&lt;div&gt;');</span> </td>
                  </tr><tr>
                          <th>92</th><th>92</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="last first">
                          <th> </th><th>93</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Owners</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>93</th><th>94</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!empty($Event-&gt;Organisations)) {</span> </td>
                  </tr><tr>
                          <th>94</th><th>95</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $organisers = array();</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>95</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Event-&gt;Organisations as $organisation) {</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>96</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Event-&gt;Organisations as $org) {</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>97</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $organisation = &amp;$org['org'];</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>96</th><th>98</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $org_text = '';</span> </td>
                  </tr><tr>
                          <th>97</th><th>99</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($organisation-&gt;InDirectory) {</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event.php?rev=163a31104027312eacc355b02dd9f8f0d7ddeb52#L102">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event.php?rev=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff#L104">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>102</th><th>104</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $org_text .= '&lt;/a&gt;';</span> </td>
                  </tr><tr>
                          <th>103</th><th>105</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>106</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!$org['confirmed']) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>107</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $org_text .= ' (unconfirmed)';</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>108</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>104</th><th>109</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $organisers[] = $org_text;</span> </td>
                  </tr><tr>
                          <th>105</th><th>110</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>106</th><th>111</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo('Organiser'.(count($organisers)&gt;1 ? 's' : '').': '.implode(', ', $organisers));</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>112</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo('&lt;br /&gt;');</ins> </td>
                  </tr><tr>
                          <th> </th><th>113</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>114</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Subscribers</ins> </td>
                  </tr><tr>
                          <th> </th><th>115</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!empty($Event-&gt;Subscribers)) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>116</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $organisers = array();</ins> </td>
                  </tr><tr>
                          <th> </th><th>117</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Event-&gt;Subscribers as $org) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>118</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $organisation = &amp;$org['org'];</ins> </td>
                  </tr><tr>
                          <th> </th><th>119</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $org_text = '';</ins> </td>
                  </tr><tr>
                          <th> </th><th>120</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($organisation-&gt;InDirectory) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>121</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $org_text .= '&lt;a href="'.site_url('directory/'.$organisation-&gt;ShortName).'"&gt;';</ins> </td>
                  </tr><tr>
                          <th> </th><th>122</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>123</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $org_text .= xml_escape($organisation-&gt;Name);</ins> </td>
                  </tr><tr>
                          <th> </th><th>124</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($organisation-&gt;InDirectory) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>125</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $org_text .= '&lt;/a&gt;';</ins> </td>
                  </tr><tr>
                          <th> </th><th>126</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>127</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!$org['confirmed']) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>128</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $org_text .= ' (unconfirmed)';</ins> </td>
                  </tr><tr>
                          <th> </th><th>129</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>130</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $organisers[] = $org_text;</ins> </td>
                  </tr><tr>
                          <th> </th><th>131</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>132</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo('Calendar'.(count($organisers)&gt;1 ? 's' : '').': '.implode(', ', $organisers));</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>107</th><th>133</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo('&lt;br /&gt;');</span> </td>
                  </tr><tr>
                          <th>108</th><th>134</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
  </ul>
</div>
      </div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff?format=diff&new=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff" class="diff">Unified Diff</a>
        </li><li class="last">
          <a rel="nofollow" href="http://dev2.theyorker.co.uk/trac/changeset/bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff?format=zip&new=bf56871bfb8f667bb5c9699d4be8eb2e6ebb80ff" class="zip">Zip Archive</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">
        Powered by <a href="../about.html"><strong>Trac 0.11.1</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.
      </p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>