<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  

  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>
      Changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465 –
      The Yorker
    </title>
        <link rel="search" href="../search.html" />
        <link rel="prev" href="075fb8aada0007e62ea0ccb1286bb88b9f0762a6.html" title="Changeset 075fb8aada0007e62ea0ccb1286bb88b9f0762a6" />
        <link rel="last" href="4663e7077f9a41a86111194402f498613109bfa4.html" title="Changeset 4663e7077f9a41a86111194402f498613109bfa4" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465?format=diff&new=c31b59d2a4c5115d191c94a6a1c15a8a733cc465" type="text/plain" class="diff" title="Unified Diff" /><link rel="alternate" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465?format=zip&new=c31b59d2a4c5115d191c94a6a1c15a8a733cc465" type="application/zip" class="zip" title="Zip Archive" />
        <link rel="next" href="daf641d0f480232860e09940f1ee9ba984fa3e34.html" title="Changeset daf641d0f480232860e09940f1ee9ba984fa3e34" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/changeset.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/diff.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/code.css" type="text/css" />
        <link rel="first" href="8f01cfef778eb063e661839b60a7226601ef07b1.html" title="Changeset 8f01cfef778eb063e661839b60a7226601ef07b1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search The Yorker" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/diff.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("li.entry h2 a").parent().addAnchor("Link to this diff");
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="../../trac.html"><img src="../../apps-logo.png" alt="The Yorker" /></a>
      </div>
      <form id="search" action="/trac/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first">logged in as nick_evans</li><li><a href="../../trac.html">Logout</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../browser.html">Browse Source</a></li><li><a href="../report.html">View Tickets</a></li><li><a href="../newticket.html">New Ticket</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
            <li class="first "><span>&larr; <a class="prev" href="075fb8aada0007e62ea0ccb1286bb88b9f0762a6.html" title="Changeset 075fb8aada0007e62ea0ccb1286bb88b9f0762a6">Previous Changeset</a></span></li><li class="last"><span><a class="next" href="daf641d0f480232860e09940f1ee9ba984fa3e34.html" title="Changeset daf641d0f480232860e09940f1ee9ba984fa3e34">Next Changeset</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="changeset">
      <div id="title">
        <h1>Changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465</h1>
      </div>
      <form id="prefs" action="">
        <div>
    <label for="style">View differences</label>
    <select id="style" name="style">
      <option selected="selected" value="inline">inline</option>
      <option value="sidebyside">side by side</option>
    </select>
    <div class="field">
      Show <input type="text" name="contextlines" id="contextlines" size="2" maxlength="3" value="2" />
      <label for="contextlines">lines around each change</label>
    </div>
    <fieldset id="ignore">
      <legend>Ignore:</legend>
      <div class="field">
        <input type="checkbox" id="ignoreblanklines" name="ignoreblanklines" />
        <label for="ignoreblanklines">Blank lines</label>
      </div>
      <div class="field">
        <input type="checkbox" id="ignorecase" name="ignorecase" />
        <label for="ignorecase">Case changes</label>
      </div>
      <div class="field">
        <input type="checkbox" id="ignorewhitespace" name="ignorewhitespace" />
        <label for="ignorewhitespace">White space changes</label>
      </div>
    </fieldset>
    <div class="buttons">
      <input type="submit" name="update" value="Update" />
    </div>
        </div>
      </form>
      <dl id="overview">
          <dt class="property time">Timestamp:</dt>
          <dd class="time">10/22/07 22:13:05 (<a class="timeline" href="http://dev2.theyorker.co.uk/trac/timeline?from=2007-10-22T22%3A13%3A05Z%2B0000&precision=second" title="2007-10-22T22:13:05Z+0000 in Timeline">8 years</a> ago)</dd>
          <dt class="property author">Author:</dt>
          <dd class="author">James Hogan &lt;james_hogan@…&gt;</dd>
              <dt class="property">Parents:</dt>
              <dd><a class="changeset" href="075fb8aada0007e62ea0ccb1286bb88b9f0762a6.html" title="Correction of variable usage for converting image id's to image locations">075fb8aada0007e62ea0ccb1286bb88b9f0762a6</a></dd>
              <dt class="property">Children:</dt>
              <dd><a class="changeset" href="daf641d0f480232860e09940f1ee9ba984fa3e34.html" title="Bylines in news archive and links to view all articles by a reporter">daf641d0f480232860e09940f1ee9ba984fa3e34</a></dd>
              <dt class="property">git-committer:</dt>
              <dd>James Hogan &lt;james_hogan@theyorker.co.uk&gt; / 2007-10-22T22:13:05Z+0000</dd>
          <dt class="property message">Message:</dt>
          <dd class="message searchable">
            
            
              <p>
calendar interface improvements:<br />
mostly related to confirmation screen when saving event<br />
minical disabled while in this screen<br />
added <a class="missing wiki" href="http://dev2.theyorker.co.uk/trac/wiki/GetEventRecurChanges" rel="nofollow">GetEventRecurChanges?</a> to calendar backend to get changes that need to be made to an event's occurrences<br />
yorker source adds publish capability when vip so interface can tell what to "say"<br />
events model fixes for where inner joins were used with event_entities instead of left joins (an event_entity doesn't necessarily exist)<br />
made cancel event thing add an exclusion, although this will not be necessary with the cunning new interface<br />
split recurrence set / occurrence resolver into:<br />
</p>
<blockquote>
<p>
resolve function to do the analysis<br />
tidy function to turn an analysis into outputable stuff to ask user for confirmation<br />
commit function to take an analysis and perform the changes<br />
</p>
</blockquote>
<p>
tweak to recurrence engine so that rdates are assumed to be same time associativity of main (this may be wrong)<br />
calendar subcontroller: handle new confirmation screen<br />
event edit view: added confirmation boxes at top when an input array exists<br />
</p>

            
            
          </dd>
        <dt class="property files">Files:</dt>
        <dd class="files">
          <div class="legend" id="file-legend">
            <dl>
              <dt class="mod"></dt><dd>8 modified</dd>
            </dl>
          </div>
          <br />
          <ul>
            <li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/public_html/javascript/calendar_edit.js?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
              public_html/javascript/calendar_edit.js
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="c31b59d2a4c5115d191c94a6a1c15a8a733cc465.html#file0">1 diff</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/public_html/stylesheets/calendar.css?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
              public_html/stylesheets/calendar.css
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="c31b59d2a4c5115d191c94a6a1c15a8a733cc465.html#file1">1 diff</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
              system/application/libraries/Calendar_backend.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="c31b59d2a4c5115d191c94a6a1c15a8a733cc465.html#file2">2 diffs</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
              system/application/libraries/Calendar_source_yorker.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="c31b59d2a4c5115d191c94a6a1c15a8a733cc465.html#file3">2 diffs</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
              system/application/models/calendar/events_model.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="c31b59d2a4c5115d191c94a6a1c15a8a733cc465.html#file4">23 diffs</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/recurrence_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
              system/application/models/calendar/recurrence_model.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="c31b59d2a4c5115d191c94a6a1c15a8a733cc465.html#file5">1 diff</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
              system/application/models/subcontrollers/calendar_subcontroller.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="c31b59d2a4c5115d191c94a6a1c15a8a733cc465.html#file6">6 diffs</a>)
            </li><li>
          <div class="mod"> </div>
            <a title="Show entry in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event_edit.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
              system/application/views/calendar/event_edit.php
            </a>
          <span class="comment">(modified)</span>
              (<a title="Show differences" href="c31b59d2a4c5115d191c94a6a1c15a8a733cc465.html#file7">4 diffs</a>)
            </li>
          </ul>
        </dd>
      </dl>
      <div class="diff">
        <div class="legend" id="diff-legend">
          <h3>Legend:</h3>
          <dl>
            <dt class="unmod"></dt><dd>Unmodified</dd>
            <dt class="add"></dt><dd>Added</dd>
            <dt class="rem"></dt><dd>Removed</dd>
          </dl>
        </div>
        <div class="diff">
  <ul class="entries">
      <li class="entry">
        <h2 id="file0">
          <a title="Show the changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465 restricted to public_html/javascript/calendar_edit.js" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465/public_html/javascript/calendar_edit.js">public_html/javascript/calendar_edit.js</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 89f76c876dfa0a7801465a78a5776afc6a39f8df">
                    <a title="Show revision 89f76c876dfa0a7801465a78a5776afc6a39f8df of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/public_html/javascript/calendar_edit.js?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L410">
                      r89f76</a>
                  </th>
                  <th title="Revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
                    <a title="Show revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/public_html/javascript/calendar_edit.js?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L410">
                      rc31b5</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>410</th><th>410</th><td class="l"><span>function MinicalToggle(date)</span> </td>
                  </tr><tr>
                          <th>411</th><th>411</th><td class="l"><span>{</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>412</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /*</span> </td>
                      </tr><tr>
                        <th>413</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; none -&gt; include -&gt; exclude -&gt; none</span> </td>
                      </tr><tr>
                        <th>414</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; */</span> </td>
                      </tr><tr>
                        <th>415</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; var td = document.getElementById('minical_'+date+'');</span> </td>
                      </tr><tr>
                        <th>416</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (1) {</span> </td>
                      </tr><tr>
                        <th>417</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Toggle the obvious values</span> </td>
                      </tr><tr>
                        <th>418</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (CssCheck(td, 'selected')) {</span> </td>
                      </tr><tr>
                        <th>419</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // selected, so inc -&gt; none -&gt; exc</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>412</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; // If the main edit stuff is hidden (for confirmation) check before doing anything</span> </td>
                      </tr><tr>
                        <th> </th><th>413</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (document.getElementById('main_edit_divs').style.display == 'none') {</span> </td>
                      </tr><tr>
                        <th> </th><th>414</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (confirm("Clicking on the calendar will return to edit mode and alter the event.")) {</span> </td>
                      </tr><tr>
                        <th> </th><th>415</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('eved_confirm_edit_btn').onclick();</span> </td>
                      </tr><tr>
                        <th> </th><th>416</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>417</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>418</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (document.getElementById('main_edit_divs').style.display != 'none') {</span> </td>
                      </tr><tr>
                        <th> </th><th>419</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*</span> </td>
                      </tr><tr>
                        <th> </th><th>420</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; none -&gt; include -&gt; exclude -&gt; none</span> </td>
                      </tr><tr>
                        <th> </th><th>421</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */</span> </td>
                      </tr><tr>
                        <th> </th><th>422</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var td = document.getElementById('minical_'+date+'');</span> </td>
                      </tr><tr>
                        <th> </th><th>423</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (1) {</span> </td>
                      </tr><tr>
                        <th> </th><th>424</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Toggle the obvious values</span> </td>
                      </tr><tr>
                        <th> </th><th>425</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (CssCheck(td, 'selected')) {</span> </td>
                      </tr><tr>
                        <th> </th><th>426</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // selected, so inc -&gt; none -&gt; exc</span> </td>
                      </tr><tr>
                        <th> </th><th>427</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (inc_dates[date]) {</span> </td>
                      </tr><tr>
                        <th> </th><th>428</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // inc -&gt; none</span> </td>
                      </tr><tr>
                        <th> </th><th>429</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('include', date);</span> </td>
                      </tr><tr>
                        <th> </th><th>430</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (!exc_dates[date]) {</span> </td>
                      </tr><tr>
                        <th> </th><th>431</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // none -&gt; exc</span> </td>
                      </tr><tr>
                        <th> </th><th>432</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NewInexDate('exclude', date);</span> </td>
                      </tr><tr>
                        <th> </th><th>433</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>434</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // exc -&gt; none</span> </td>
                      </tr><tr>
                        <th> </th><th>435</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('exclude', date);</span> </td>
                      </tr><tr>
                        <th> </th><th>436</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>437</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>438</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // deselected, so exc -&gt; none -&gt; inc</span> </td>
                      </tr><tr>
                        <th> </th><th>439</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (exc_dates[date]) {</span> </td>
                      </tr><tr>
                        <th> </th><th>440</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // exc -&gt; none</span> </td>
                      </tr><tr>
                        <th> </th><th>441</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('exclude', date);</span> </td>
                      </tr><tr>
                        <th> </th><th>442</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (!inc_dates[date]) {</span> </td>
                      </tr><tr>
                        <th> </th><th>443</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // none -&gt; inc</span> </td>
                      </tr><tr>
                        <th> </th><th>444</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NewInexDate('include', date);</span> </td>
                      </tr><tr>
                        <th> </th><th>445</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>446</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // inic -&gt; none</span> </td>
                      </tr><tr>
                        <th> </th><th>447</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('include', date);</span> </td>
                      </tr><tr>
                        <th> </th><th>448</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>449</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>450</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>451</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Toggle all three values</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>420</th><th>452</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (inc_dates[date]) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>421</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // inc -&gt; <del>none</del></span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>453</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // inc -&gt; <ins>exc</ins></span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>422</th><th>454</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('include', date);</span> </td>
                  </tr>
            </tbody><tbody class="rem">
                  <tr class="first">
                          <th>423</th><th> </th><td class="l"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (!exc_dates[date]) {</del> </td>
                  </tr><tr class="last">
                          <th>424</th><th> </th><td class="l"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // none -&gt; exc</del> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>425</th><th>455</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NewInexDate('exclude', date);</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>426</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else <del></del>{</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>456</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else <ins>if (exc_dates[date]) </ins>{</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>427</th><th>457</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // exc -&gt; none</span> </td>
                  </tr><tr>
                          <th>428</th><th>458</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('exclude', date);</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>429</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th>430</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th>431</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // deselected, so exc -&gt; none -&gt; inc</span> </td>
                      </tr><tr>
                        <th>432</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (exc_dates[date]) {</span> </td>
                      </tr><tr>
                        <th>433</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // exc -&gt; none</span> </td>
                      </tr><tr>
                        <th>434</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('exclude', date);</span> </td>
                      </tr><tr>
                        <th>435</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (!inc_dates[date]) {</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>459</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>436</th><th>460</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // none -&gt; inc</span> </td>
                  </tr><tr>
                          <th>437</th><th>461</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NewInexDate('include', date);</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>438</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th>439</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // inic -&gt; none</span> </td>
                      </tr><tr>
                        <th>440</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('include', date);</span> </td>
                      </tr><tr>
                        <th>441</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th>442</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th>443</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th>444</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Toggle all three values</span> </td>
                      </tr><tr>
                        <th>445</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (inc_dates[date]) {</span> </td>
                      </tr><tr>
                        <th>446</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // inc -&gt; exc</span> </td>
                      </tr><tr>
                        <th>447</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('include', date);</span> </td>
                      </tr><tr>
                        <th>448</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NewInexDate('exclude', date);</span> </td>
                      </tr><tr>
                        <th>449</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (exc_dates[date]) {</span> </td>
                      </tr><tr>
                        <th>450</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // exc -&gt; none</span> </td>
                      </tr><tr>
                        <th>451</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RemoveInexDate('exclude', date);</span> </td>
                      </tr><tr>
                        <th>452</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th>453</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // none -&gt; inc</span> </td>
                      </tr><tr>
                        <th>454</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NewInexDate('include', date);</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>462</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>455</th><th>463</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>456</th><th>464</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file1">
          <a title="Show the changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465 restricted to public_html/stylesheets/calendar.css" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465/public_html/stylesheets/calendar.css">public_html/stylesheets/calendar.css</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 89f76c876dfa0a7801465a78a5776afc6a39f8df">
                    <a title="Show revision 89f76c876dfa0a7801465a78a5776afc6a39f8df of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/public_html/stylesheets/calendar.css?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L376">
                      r89f76</a>
                  </th>
                  <th title="Revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
                    <a title="Show revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/public_html/stylesheets/calendar.css?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L376">
                      rc31b5</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>376</th><th>376</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #F0D1A0;</span> </td>
                  </tr><tr>
                          <th>377</th><th>377</th><td class="l"><span>}</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>378</th><td class="r"><ins></ins> </td>
                  </tr><tr>
                          <th> </th><th>379</th><td class="r"><ins>/* for confirmation of changes dates */</ins> </td>
                  </tr><tr>
                          <th> </th><th>380</th><td class="r"><ins>div#confirm_changes_div label.description {</ins> </td>
                  </tr><tr>
                          <th> </th><th>381</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; float: none;</ins> </td>
                  </tr><tr>
                          <th> </th><th>382</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; font-size: small;</ins> </td>
                  </tr><tr>
                          <th> </th><th>383</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; clear: none;</ins> </td>
                  </tr><tr>
                          <th> </th><th>384</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; text-align: left;</ins> </td>
                  </tr><tr>
                          <th> </th><th>385</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; width: 100%;</ins> </td>
                  </tr><tr>
                          <th> </th><th>386</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; margin: 0.0em;</ins> </td>
                  </tr><tr>
                          <th> </th><th>387</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>388</th><td class="r"><ins>div#confirm_changes_div div.description {</ins> </td>
                  </tr><tr>
                          <th> </th><th>389</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; font-size: small;</ins> </td>
                  </tr><tr>
                          <th> </th><th>390</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; clear: none;</ins> </td>
                  </tr><tr>
                          <th> </th><th>391</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>392</th><td class="r"><ins>div#confirm_changes_div fieldset.delete {</ins> </td>
                  </tr><tr>
                          <th> </th><th>393</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; float: right;</ins> </td>
                  </tr><tr>
                          <th> </th><th>394</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; clear: none;</ins> </td>
                  </tr><tr>
                          <th> </th><th>395</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>396</th><td class="r"><ins>div#confirm_changes_div div.cancel,</ins> </td>
                  </tr><tr>
                          <th> </th><th>397</th><td class="r"><ins>div#confirm_changes_div div.delete,</ins> </td>
                  </tr><tr>
                          <th> </th><th>398</th><td class="r"><ins>div#confirm_changes_div div.restore,</ins> </td>
                  </tr><tr>
                          <th> </th><th>399</th><td class="r"><ins>div#confirm_changes_div div.create,</ins> </td>
                  </tr><tr>
                          <th> </th><th>400</th><td class="r"><ins>div#confirm_changes_div div.move,</ins> </td>
                  </tr><tr>
                          <th> </th><th>401</th><td class="r"><ins>div#confirm_changes_div div.draft {</ins> </td>
                  </tr><tr>
                          <th> </th><th>402</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; border: 1px solid #808080;</ins> </td>
                  </tr><tr>
                          <th> </th><th>403</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; overflow: hidden;</ins> </td>
                  </tr><tr>
                          <th> </th><th>404</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; padding-left: 3px;</ins> </td>
                  </tr><tr>
                          <th> </th><th>405</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; padding-top: 0px;</ins> </td>
                  </tr><tr>
                          <th> </th><th>406</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; padding-bottom: 0px;</ins> </td>
                  </tr><tr>
                          <th> </th><th>407</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; padding-right: 0px;</ins> </td>
                  </tr><tr>
                          <th> </th><th>408</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>409</th><td class="r"><ins>div#confirm_changes_div div.cancel {</ins> </td>
                  </tr><tr>
                          <th> </th><th>410</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #FFB0B0;</ins> </td>
                  </tr><tr>
                          <th> </th><th>411</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>412</th><td class="r"><ins>div#confirm_changes_div div.delete {</ins> </td>
                  </tr><tr>
                          <th> </th><th>413</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #FFC080;</ins> </td>
                  </tr><tr>
                          <th> </th><th>414</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>415</th><td class="r"><ins>div#confirm_changes_div div.restore {</ins> </td>
                  </tr><tr>
                          <th> </th><th>416</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #B0B0FF;</ins> </td>
                  </tr><tr>
                          <th> </th><th>417</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>418</th><td class="r"><ins>div#confirm_changes_div div.create {</ins> </td>
                  </tr><tr>
                          <th> </th><th>419</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #80FF80;</ins> </td>
                  </tr><tr>
                          <th> </th><th>420</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>421</th><td class="r"><ins>div#confirm_changes_div div.move {</ins> </td>
                  </tr><tr>
                          <th> </th><th>422</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #FFFF80;</ins> </td>
                  </tr><tr>
                          <th> </th><th>423</th><td class="r"><ins>}</ins> </td>
                  </tr><tr>
                          <th> </th><th>424</th><td class="r"><ins>div#confirm_changes_div div.draft {</ins> </td>
                  </tr><tr>
                          <th> </th><th>425</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #F0F0F0;</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>426</th><td class="r"><ins>}</ins> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file2">
          <a title="Show the changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465 restricted to system/application/libraries/Calendar_backend.php" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465/system/application/libraries/Calendar_backend.php">system/application/libraries/Calendar_backend.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 968b04aaed0d8ebc2446bbbb972f282a97b5300d">
                    <a title="Show revision 968b04aaed0d8ebc2446bbbb972f282a97b5300d of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=968b04aaed0d8ebc2446bbbb972f282a97b5300d#L583">
                      r968b0</a>
                  </th>
                  <th title="Revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
                    <a title="Show revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L583">
                      rc31b5</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>583</th><th>583</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>584</th><th>584</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>585</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// Get the changes to update an event to a specified recurrence set.</ins> </td>
                  </tr><tr>
                          <th> </th><th>586</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /**</ins> </td>
                  </tr><tr>
                          <th> </th><th>587</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $Event &amp;CalendarEvent Event information.</ins> </td>
                  </tr><tr>
                          <th> </th><th>588</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $RSet RecurrenceSet&nbsp; &nbsp;Recurrence information.</ins> </td>
                  </tr><tr>
                          <th> </th><th>589</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @return array Information about the changes that must be made.</ins> </td>
                  </tr><tr>
                          <th> </th><th>590</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</ins> </td>
                  </tr><tr>
                          <th> </th><th>591</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; function GetEventRecurChanges($Event, $RSet)</ins> </td>
                  </tr><tr>
                          <th> </th><th>592</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins> </td>
                  </tr><tr>
                          <th> </th><th>593</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return NULL;</ins> </td>
                  </tr><tr>
                          <th> </th><th>594</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>595</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>585</th><th>596</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Ammend an event.</span> </td>
                  </tr><tr>
                          <th>586</th><th>597</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /**</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=968b04aaed0d8ebc2446bbbb972f282a97b5300d#L1188">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_backend.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1199">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1188</th><th>1199</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1189</th><th>1200</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1201</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// Get the changes to update an event to a specified recurrence set.</ins> </td>
                  </tr><tr>
                          <th> </th><th>1202</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; function GetEventRecurChanges($Event, $RSet)</ins> </td>
                  </tr><tr>
                          <th> </th><th>1203</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins> </td>
                  </tr><tr>
                          <th> </th><th>1204</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (array_key_exists($Event-&gt;Source-&gt;GetSourceId(), $this-&gt;mSources)) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>1205</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;mSources[$Event-&gt;Source-&gt;GetSourceId()]-&gt;GetEventRecurChanges($Event, $RSet);</ins> </td>
                  </tr><tr>
                          <th> </th><th>1206</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</ins> </td>
                  </tr><tr>
                          <th> </th><th>1207</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return parent::GetEventRecurChanges($Event, $RSet);</ins> </td>
                  </tr><tr>
                          <th> </th><th>1208</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>1209</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1210</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1190</th><th>1211</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Ammend an event</span> </td>
                  </tr><tr>
                          <th>1191</th><th>1212</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; function AmmendEvent($Event, $Changes)</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file3">
          <a title="Show the changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465 restricted to system/application/libraries/Calendar_source_yorker.php" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465/system/application/libraries/Calendar_source_yorker.php">system/application/libraries/Calendar_source_yorker.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 2f47b71eb7d9ffd10913797a012cebf4f090a9bd">
                    <a title="Show revision 2f47b71eb7d9ffd10913797a012cebf4f090a9bd of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L46">
                      r2f47b</a>
                  </th>
                  <th title="Revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
                    <a title="Show revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L46">
                      rc31b5</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>46</th><th>46</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!$CI-&gt;events_model-&gt;IsReadOnly()) {</span> </td>
                  </tr><tr>
                          <th>47</th><th>47</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;mCapabilities[] = 'create';</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>48</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>49</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($CI-&gt;events_model-&gt;IsVip()) {</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>50</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;mCapabilities[] = 'publish';</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>48</th><th>51</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>49</th><th>52</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;mCapabilities[] = 'attend';</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L598">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/libraries/Calendar_source_yorker.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L601">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>598</th><th>601</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>599</th><th>602</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>603</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /// Get the changes to update an event to a specified recurrence set.</ins> </td>
                  </tr><tr>
                          <th> </th><th>604</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /**</ins> </td>
                  </tr><tr>
                          <th> </th><th>605</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $Event &amp;CalendarEvent Event information.</ins> </td>
                  </tr><tr>
                          <th> </th><th>606</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $RSet RecurrenceSet&nbsp; &nbsp;Recurrence information.</ins> </td>
                  </tr><tr>
                          <th> </th><th>607</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @return array Information about the changes that must be made.</ins> </td>
                  </tr><tr>
                          <th> </th><th>608</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</ins> </td>
                  </tr><tr>
                          <th> </th><th>609</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; function GetEventRecurChanges($Event, $RSet)</ins> </td>
                  </tr><tr>
                          <th> </th><th>610</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins> </td>
                  </tr><tr>
                          <th> </th><th>611</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $CI = &amp; get_instance();</ins> </td>
                  </tr><tr>
                          <th> </th><th>612</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $changes = $CI-&gt;events_model-&gt;ResolveRecurrenceSetOccurrences($Event-&gt;SourceEventId, $RSet);</ins> </td>
                  </tr><tr>
                          <th> </th><th>613</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $CI-&gt;events_model-&gt;TidyRecurrenceSetOccurrencesChanges($changes);</ins> </td>
                  </tr><tr>
                          <th> </th><th>614</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>615</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>600</th><th>616</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Ammend an event.</span> </td>
                  </tr><tr>
                          <th>601</th><th>617</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; /**</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file4">
          <a title="Show the changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465 restricted to system/application/models/calendar/events_model.php" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465/system/application/models/calendar/events_model.php">system/application/models/calendar/events_model.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 2f47b71eb7d9ffd10913797a012cebf4f090a9bd">
                    <a title="Show revision 2f47b71eb7d9ffd10913797a012cebf4f090a9bd of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1049">
                      r2f47b</a>
                  </th>
                  <th title="Revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
                    <a title="Show revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1049">
                      rc31b5</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>1049</th><th>1049</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN event_types</span> </td>
                  </tr><tr>
                          <th>1050</th><th>1050</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; events.event_type_id = event_types.event_type_id</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1051</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INNER JOIN event_entities</span> </td>
                      </tr><tr>
                        <th>1052</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_entities.event_entity_event_id = events.event_id</span> </td>
                      </tr><tr>
                        <th>1053</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;' . $occurrence_query-&gt;ExpressionOwned();</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1051</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN event_entities</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1052</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_entities.event_entity_event_id = events.event_id';</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1054</th><th>1053</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($RecurrenceRule) {</span> </td>
                  </tr><tr>
                          <th>1055</th><th>1054</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql .= '</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1071">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1070">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1071</th><th>1070</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $bind_data += $FilterBind;</span> </td>
                  </tr><tr>
                          <th>1072</th><th>1071</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="last first">
                          <th> </th><th>1072</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql .= ' WHERE ' . $occurrence_query-&gt;ExpressionOwned();</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1073</th><th>1073</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!empty($conditions)) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1074</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql .= '</span> </td>
                      </tr><tr>
                        <th>1075</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE ' . implode(' AND ',$conditions);</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1074</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql .= ' AND ' . implode(' AND ',$conditions);</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1076</th><th>1075</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1077</th><th>1076</th><td class="l"><span></span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1327">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1326">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1327</th><th>1326</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($num_events &amp;&amp; isset($EventData['recur'])) {</span> </td>
                  </tr><tr>
                          <th>1328</th><th>1327</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;recurrence_model-&gt;UpdateRecurrenceSet($EventData['recur'], $event_id);</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1329</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;ResolveRecurrenceSetOccurrences($event_id, $EventData['recur']);</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1328</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $changes = $this-&gt;ResolveRecurrenceSetOccurrences($event_id, $EventData['recur']);</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1329</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;CommitRecurrenceSetOccurrences($event_id, $changes);</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1330</th><th>1330</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1331</th><th>1331</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1633">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1633">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1633</th><th>1633</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!empty($sets)) {</span> </td>
                  </tr><tr>
                          <th>1634</th><th>1634</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql = 'UPDATE event_occurrences</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1635</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <del>INNER</del> JOIN event_entities</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1635</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <ins>LEFT</ins> JOIN event_entities</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1636</th><th>1636</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_entities.event_entity_event_id</span> </td>
                  </tr><tr>
                          <th>1637</th><th>1637</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = event_occurrences.event_occurrence_event_id</span> </td>
                  </tr>
            </tbody><tbody class="rem">
                  <tr class="last first">
                          <th>1638</th><th> </th><td class="l"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND ' . $occurrence_query-&gt;ExpressionOwned() . '</del> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1639</th><th>1638</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET ' . implode(', ', $sets) . '</span> </td>
                  </tr><tr>
                          <th>1640</th><th>1639</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE&nbsp; &nbsp;event_occurrences.event_occurrence_id = ?</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1641</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_occurrences.event_occurrence_event_id = ?';</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1640</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_occurrences.event_occurrence_event_id = ?</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1641</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND ' . $occurrence_query-&gt;ExpressionOwned();</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1642</th><th>1642</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $bind_data[] = $occurrence['id'];</span> </td>
                  </tr><tr>
                          <th>1643</th><th>1643</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $bind_data[] = $EventId;</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1654">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1654">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1654</th><th>1654</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $EventId int ID of event.</span> </td>
                  </tr><tr>
                          <th>1655</th><th>1655</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $RSet RecurrenceSet The recurrence information.</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1656</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @return array of change lists. The intention is for this to be passed</ins> </td>
                  </tr><tr>
                          <th> </th><th>1657</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; into @a CommitRecurrenceSetOccurrences without change.</ins> </td>
                  </tr><tr>
                          <th> </th><th>1658</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - 'remove'</ins> </td>
                  </tr><tr>
                          <th> </th><th>1659</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - 'move'</ins> </td>
                  </tr><tr>
                          <th> </th><th>1660</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - 'create'</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1661</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; - 'restore'</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1656</th><th>1662</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*</span> </td>
                  </tr><tr>
                          <th>1657</th><th>1663</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* This is pretty clever little function. It figures out the differences</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1661">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1667">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1661</th><th>1667</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; function ResolveRecurrenceSetOccurrences($EventId, &amp; $RSet)</span> </td>
                  </tr><tr>
                          <th>1662</th><th>1668</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1663</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $range_start = <del>time(</del>);</span> </td>
                      </tr><tr>
                        <th>1664</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $range_end = strtotime('<del></del>+2years');</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1669</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $range_start = <ins>strtotime('today'</ins>);</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1670</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $range_end = strtotime('<ins>today</ins>+2years');</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1665</th><th>1671</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr><tr>
                          <th>1666</th><th>1672</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Get all occurrences of the event</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1684">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1690">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1684</th><th>1690</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr><tr>
                          <th>1685</th><th>1691</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Arrays for storing actions chosen by analysis.</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1686</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $remove_list&nbsp; = array();</span> </td>
                      </tr><tr>
                        <th>1687</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $move_list&nbsp; &nbsp; = array();</span> </td>
                      </tr><tr>
                        <th>1688</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $create_list&nbsp; = array();</span> </td>
                      </tr><tr>
                        <th>1689</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $restore_list = array();</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1692</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $results = array();</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1690</th><th>1693</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr><tr>
                          <th>1691</th><th>1694</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Reformat occurrence data into time indexing</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1706">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1709">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1706</th><th>1709</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($occurrences[$day][$time])) {</span> </td>
                  </tr><tr>
                          <th>1707</th><th>1710</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($occurrence['active']) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1708</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!$occurrence<del></del>[$day][$time]['active']) {</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1711</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!$occurrence<ins>s</ins>[$day][$time]['active']) {</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1709</th><th>1712</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $occurrences[$day][$time] = $occurrence;</span> </td>
                  </tr><tr>
                          <th>1710</th><th>1713</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                  </tr><tr>
                          <th>1711</th><th>1714</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Already an occurrence here, so delete this one</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1712</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $re<del>move_list</del>[] = $occurrence;</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1715</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $re<ins>sults['remove']</ins>[] = $occurrence;</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1713</th><th>1716</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1714</th><th>1717</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1733">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1736">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1733</th><th>1736</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Its gotta be in the future for us to do anything about it</span> </td>
                  </tr><tr>
                          <th>1734</th><th>1737</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($occurrence['active'] &amp;&amp; $occurrence['start_time'] &gt;= $range_start) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1735</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $re<del>move_list</del>[] = $occurrence;</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1738</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $re<ins>sults['remove']</ins>[] = $occurrence;</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1736</th><th>1739</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1737</th><th>1740</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1747">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1750">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1747</th><th>1750</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!$active and $willexist) {</span> </td>
                  </tr><tr>
                          <th>1748</th><th>1751</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // an inactive event has been restored</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1749</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $res<del>tore_list</del>[] = array($occurrence, $recurrences[$day][$time]);</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1752</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $res<ins>ults['restore']</ins>[] = array($occurrence, $recurrences[$day][$time]);</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1750</th><th>1753</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ($active and !$willexist) {</span> </td>
                  </tr><tr>
                          <th>1751</th><th>1754</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // an active event has been removed</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1754">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1757">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1754</th><th>1757</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ($active and $willexist) {</span> </td>
                  </tr><tr>
                          <th>1755</th><th>1758</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($occurrence['duration'] !== $recurrences[$day][$time]) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1756</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<del>move_list</del>[] = array(</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1759</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<ins>results['move']</ins>[] = array(</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1757</th><th>1760</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $occurrence,</span> </td>
                  </tr><tr>
                          <th>1758</th><th>1761</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array(</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1774">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1777">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1774</th><th>1777</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                  </tr><tr>
                          <th>1775</th><th>1778</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $changed_times[$time] = $recurrence_info;</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1779</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ($times[$time]['state'] == 'draft') {</ins> </td>
                  </tr><tr>
                          <th> </th><th>1780</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $results['draft'][] = array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>1781</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'day' =&gt; $day,</ins> </td>
                  </tr><tr>
                          <th> </th><th>1782</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'time' =&gt; $time,</ins> </td>
                  </tr><tr>
                          <th> </th><th>1783</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'duration' =&gt; $duration,</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1784</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1776</th><th>1785</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1777</th><th>1786</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1790">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1799">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1790</th><th>1799</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Another of same newness, take action with last one</span> </td>
                  </tr><tr>
                          <th>1791</th><th>1800</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($last_new) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1792</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<del>create_list</del>[] = $last_occ;</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1801</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<ins>results['create']</ins>[] = $last_occ;</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1793</th><th>1802</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1794</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $re<del>move_list</del>[] = $last_occ;</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1803</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $re<ins>sults['remove']</ins>[] = $last_occ;</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1795</th><th>1804</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1796</th><th>1805</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $last_occ = $occurrence;</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1798">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1807">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1798</th><th>1807</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Pair this and previous, and restart the sequence</span> </td>
                  </tr><tr>
                          <th>1799</th><th>1808</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($last_new) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1800</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<del>move_list</del>[] = array($occurrence, $last_occ);</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1809</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<ins>results['move']</ins>[] = array($occurrence, $last_occ);</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1801</th><th>1810</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1802</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<del>move_list</del>[] = array($last_occ, $occurrence);</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1811</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<ins>results['move']</ins>[] = array($last_occ, $occurrence);</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1803</th><th>1812</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1804</th><th>1813</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $last_new = NULL;</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1807">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1816">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1807</th><th>1816</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Unmatched at end?</span> </td>
                  </tr><tr>
                          <th>1808</th><th>1817</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($last_new === TRUE) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1809</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<del>create_list</del>[] = $last_occ;</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1818</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<ins>results['create']</ins>[] = $last_occ;</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1810</th><th>1819</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ($last_new === FALSE) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1811</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $re<del>move_list</del>[] = $last_occ;</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1820</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $re<ins>sults['remove']</ins>[] = $last_occ;</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1812</th><th>1821</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1813</th><th>1822</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1818">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1827">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1818</th><th>1827</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!isset($occurrences[$day])) {</span> </td>
                  </tr><tr>
                          <th>1819</th><th>1828</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($times as $time =&gt; $duration) {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1820</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<del>create_list</del>[] = array(</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>1829</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $<ins>results['create']</ins>[] = array(</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1821</th><th>1830</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'day' =&gt; $day,</span> </td>
                  </tr><tr>
                          <th>1822</th><th>1831</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'time' =&gt; $time,</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L1826">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1835">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1826</th><th>1835</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1827</th><th>1836</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1828</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th>1829</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*</span> </td>
                      </tr><tr>
                        <th>1830</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Output the action lists</span> </td>
                      </tr><tr>
                        <th>1831</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddDumpMessage('remove', $remove_list);</span> </td>
                      </tr><tr>
                        <th>1832</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddDumpMessage('move', $move_list);</span> </td>
                      </tr><tr>
                        <th>1833</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddDumpMessage('create', $create_list);</span> </td>
                      </tr><tr>
                        <th>1834</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddDumpMessage('restore', $restore_list);</span> </td>
                      </tr><tr>
                        <th>1835</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span> </td>
                      </tr><tr>
                        <th>1836</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //*/</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1837</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // calculate start timestamps of create list.</span> </td>
                      </tr><tr>
                        <th> </th><th>1838</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($results['create'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1839</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($results['create'] as &amp;$recurrence) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1840</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence['start_time'] = strtotime($recurrence['day'].' '.$recurrence['time']);</span> </td>
                      </tr><tr>
                        <th> </th><th>1841</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL !== $recurrence['duration']) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1842</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence['end_time'] = strtotime($recurrence['duration'].' seconds', $recurrence['start_time']);</span> </td>
                      </tr><tr>
                        <th> </th><th>1843</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>1844</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence['end_time'] = NULL;</span> </td>
                      </tr><tr>
                        <th> </th><th>1845</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1846</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1847</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1848</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // calculate final start timestamps of move list.</span> </td>
                      </tr><tr>
                        <th> </th><th>1849</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($results['move'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1850</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($results['move'] as &amp;$info) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1851</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence = &amp; $info[1];</span> </td>
                      </tr><tr>
                        <th> </th><th>1852</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence['start_time'] = strtotime($recurrence['day'].' '.$recurrence['time']);</span> </td>
                      </tr><tr>
                        <th> </th><th>1853</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL !== $recurrence['duration']) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1854</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence['end_time'] = strtotime($recurrence['duration'].' seconds', $recurrence['start_time']);</span> </td>
                      </tr><tr>
                        <th> </th><th>1855</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>1856</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence['end_time'] = NULL;</span> </td>
                      </tr><tr>
                        <th> </th><th>1857</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1858</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1859</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1860</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Return the change information.</span> </td>
                      </tr><tr>
                        <th> </th><th>1861</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $results;</span> </td>
                      </tr><tr>
                        <th> </th><th>1862</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1863</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th> </th><th>1864</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Tidy the result of ResolveRecurrenceSetOccurrences</span> </td>
                      </tr><tr>
                        <th> </th><th>1865</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; function TidyRecurrenceSetOccurrencesChanges($Changes)</span> </td>
                      </tr><tr>
                        <th> </th><th>1866</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                      </tr><tr>
                        <th> </th><th>1867</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list = array();</span> </td>
                      </tr><tr>
                        <th> </th><th>1868</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Changes as $change_type =&gt; $occurrences) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1869</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($change_type == 'remove') {</span> </td>
                      </tr><tr>
                        <th> </th><th>1870</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($occurrences as $occurrence) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1871</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Split into cancel and delete</span> </td>
                      </tr><tr>
                        <th> </th><th>1872</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_type = NULL;</span> </td>
                      </tr><tr>
                        <th> </th><th>1873</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch ($occurrence['state']) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1874</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'draft':</span> </td>
                      </tr><tr>
                        <th> </th><th>1875</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'movedraft':</span> </td>
                      </tr><tr>
                        <th> </th><th>1876</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // delete</span> </td>
                      </tr><tr>
                        <th> </th><th>1877</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_type = 'delete';</span> </td>
                      </tr><tr>
                        <th> </th><th>1878</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr>
                        <th> </th><th>1879</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'published':</span> </td>
                      </tr><tr>
                        <th> </th><th>1880</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // cancel</span> </td>
                      </tr><tr>
                        <th> </th><th>1881</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_type = 'cancel';</span> </td>
                      </tr><tr>
                        <th> </th><th>1882</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr>
                        <th> </th><th>1883</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1884</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL !== $confirm_type) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1885</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list[$confirm_type][$occurrence['day']] = array(</span> </td>
                      </tr><tr>
                        <th> </th><th>1886</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'start_time' =&gt; $occurrence['start_time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1887</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'end_time' =&gt; $occurrence['end_time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1888</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'duration' =&gt; $occurrence['duration'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1889</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'day' =&gt; $occurrence['day'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1890</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'time' =&gt; $occurrence['time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1891</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>1892</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1893</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1894</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ($change_type == 'restore') {</span> </td>
                      </tr><tr>
                        <th> </th><th>1895</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($occurrences as $info) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1896</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list($occurrence, $duration) = $info;</span> </td>
                      </tr><tr>
                        <th> </th><th>1897</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Split into create and restore</span> </td>
                      </tr><tr>
                        <th> </th><th>1898</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_type = NULL;</span> </td>
                      </tr><tr>
                        <th> </th><th>1899</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch ($occurrence['state']) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1900</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'deleted':</span> </td>
                      </tr><tr>
                        <th> </th><th>1901</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'trashed':</span> </td>
                      </tr><tr>
                        <th> </th><th>1902</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // create</span> </td>
                      </tr><tr>
                        <th> </th><th>1903</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_type = 'create';</span> </td>
                      </tr><tr>
                        <th> </th><th>1904</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr>
                        <th> </th><th>1905</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'cancelled':</span> </td>
                      </tr><tr>
                        <th> </th><th>1906</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // restore</span> </td>
                      </tr><tr>
                        <th> </th><th>1907</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_type = 'restore';</span> </td>
                      </tr><tr>
                        <th> </th><th>1908</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr>
                        <th> </th><th>1909</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1910</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL !== $confirm_type) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1911</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list[$confirm_type][$occurrence['day']] = array(</span> </td>
                      </tr><tr>
                        <th> </th><th>1912</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'start_time' =&gt; $occurrence['start_time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1913</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'end_time' =&gt; $occurrence['end_time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1914</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'duration' =&gt; $occurrence['duration'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1915</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'day' =&gt; $occurrence['day'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1916</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'time' =&gt; $occurrence['time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1917</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>1918</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1919</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th> </th><th>1920</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1921</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ($change_type == 'move') {</span> </td>
                      </tr><tr>
                        <th> </th><th>1922</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($occurrences as $info) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1923</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list($occurrence, $recurrence) = $info;</span> </td>
                      </tr><tr>
                        <th> </th><th>1924</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list['move'][$occurrence['day']] = array(</span> </td>
                      </tr><tr>
                        <th> </th><th>1925</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'start_time' =&gt; $occurrence['start_time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1926</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'end_time' =&gt; $occurrence['end_time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1927</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'duration' =&gt; $occurrence['duration'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1928</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'day' =&gt; $occurrence['day'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1929</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'time' =&gt; $occurrence['time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1930</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'new_start_time' =&gt; $recurrence['start_time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1931</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'new_end_time' =&gt; $recurrence['end_time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1932</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'new_duration' =&gt; $recurrence['duration'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1933</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'new_day' =&gt; $recurrence['day'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1934</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'new_time' =&gt; $recurrence['time'],</span> </td>
                      </tr><tr>
                        <th> </th><th>1935</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>1936</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th> </th><th>1937</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1938</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ($change_type == 'draft') {</span> </td>
                      </tr><tr>
                        <th> </th><th>1939</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($occurrences as $recurrence) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1940</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence['start_time'] = strtotime($recurrence['day'].' '.$recurrence['time']);</span> </td>
                      </tr><tr>
                        <th> </th><th>1941</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL !== $recurrence['duration']) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1942</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence['end_time'] = strtotime($recurrence['duration'].' seconds', $recurrence['start_time']);</span> </td>
                      </tr><tr>
                        <th> </th><th>1943</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>1944</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $recurrence['end_time'] = NULL;</span> </td>
                      </tr><tr>
                        <th> </th><th>1945</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1946</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list[$change_type][$recurrence['day']] = $recurrence;</span> </td>
                      </tr><tr>
                        <th> </th><th>1947</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1948</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>1949</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Copy over</span> </td>
                      </tr><tr>
                        <th> </th><th>1950</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($occurrences as $info) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1951</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list[$change_type][$info['day']] = $info;</span> </td>
                      </tr><tr>
                        <th> </th><th>1952</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1953</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1954</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1955</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($confirm_list as $key =&gt; &amp;$values) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1956</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ksort($values);</span> </td>
                      </tr><tr>
                        <th> </th><th>1957</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1958</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $confirm_list;</span> </td>
                      </tr><tr>
                        <th> </th><th>1959</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1960</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th> </th><th>1961</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Commit changes to occurrences.</span> </td>
                      </tr><tr>
                        <th> </th><th>1962</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /**</span> </td>
                      </tr><tr>
                        <th> </th><th>1963</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $EventId int ID of event.</span> </td>
                      </tr><tr>
                        <th> </th><th>1964</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $Changes as returned by @a ResolveRecurrenceSetOccurrences.</span> </td>
                      </tr><tr>
                        <th> </th><th>1965</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span> </td>
                      </tr><tr>
                        <th> </th><th>1966</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; function CommitRecurrenceSetOccurrences($EventId, $Changes)</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1967</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1837</th><th>1968</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Now we have the lists of changes:</span> </td>
                  </tr><tr>
                          <th>1838</th><th>1969</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // remove</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1839</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($remove_list as $occurrence) {</span> </td>
                      </tr><tr>
                        <th>1840</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch ($occurrence['state']) {</span> </td>
                      </tr><tr>
                        <th>1841</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'draft':</span> </td>
                      </tr><tr>
                        <th>1842</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'movedraft':</span> </td>
                      </tr><tr>
                        <th>1843</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // delete</span> </td>
                      </tr><tr>
                        <th>1844</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'deleted');</span> </td>
                      </tr><tr>
                        <th>1845</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr>
                        <th>1846</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'published':</span> </td>
                      </tr><tr>
                        <th>1847</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // cancel</span> </td>
                      </tr><tr>
                        <th>1848</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'cancelled');</span> </td>
                      </tr><tr>
                        <th>1849</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1970</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($Changes['remove'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1971</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Changes['remove'] as $occurrence) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1972</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch ($occurrence['state']) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1973</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'draft':</span> </td>
                      </tr><tr>
                        <th> </th><th>1974</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'movedraft':</span> </td>
                      </tr><tr>
                        <th> </th><th>1975</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // delete</span> </td>
                      </tr><tr>
                        <th> </th><th>1976</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'deleted');</span> </td>
                      </tr><tr>
                        <th> </th><th>1977</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr>
                        <th> </th><th>1978</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'published':</span> </td>
                      </tr><tr>
                        <th> </th><th>1979</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // cancel</span> </td>
                      </tr><tr>
                        <th> </th><th>1980</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'cancelled');</span> </td>
                      </tr><tr>
                        <th> </th><th>1981</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1982</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1850</th><th>1983</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1851</th><th>1984</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1852</th><th>1985</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // create</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1853</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($create_list as $recurrence) {</span> </td>
                      </tr><tr>
                        <th>1854</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // create occurrences as drafts</span> </td>
                      </tr><tr>
                        <th>1855</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $start_time = strtotime($recurrence['day'].' '.$recurrence['time']);</span> </td>
                      </tr><tr>
                        <th>1856</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL !== $duration) {</span> </td>
                      </tr><tr>
                        <th>1857</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $end_time = strtotime($recurrence['duration'].' seconds', $start_time);</span> </td>
                      </tr><tr>
                        <th>1858</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th>1859</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $end_time = NULL;</span> </td>
                      </tr><tr>
                        <th>1860</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th>1861</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql_insert = 'INSERT INTO event_occurrences (</span> </td>
                      </tr><tr>
                        <th>1862</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_event_id,</span> </td>
                      </tr><tr>
                        <th>1863</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_state,</span> </td>
                      </tr><tr>
                        <th>1864</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_location_name,</span> </td>
                      </tr><tr>
                        <th>1865</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_original_start_time,</span> </td>
                      </tr><tr>
                        <th>1866</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_start_time,</span> </td>
                      </tr><tr>
                        <th>1867</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_end_time)</span> </td>
                      </tr><tr>
                        <th>1868</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VALUES ('.$this-&gt;db-&gt;Escape($EventId).',</span> </td>
                      </tr><tr>
                        <th>1869</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "draft",</span> </td>
                      </tr><tr>
                        <th>1870</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "",FROM_UNIXTIME('.$start_time.'),FROM_UNIXTIME('.$start_time.'),FROM_UNIXTIME('.$end_time.'))';</span> </td>
                      </tr><tr>
                        <th>1871</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;db-&gt;query($sql_insert);</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1986</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($Changes['create'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1987</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Changes['create'] as $recurrence) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1988</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // create occurrences as drafts</span> </td>
                      </tr><tr>
                        <th> </th><th>1989</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql_insert = 'INSERT INTO event_occurrences (</span> </td>
                      </tr><tr>
                        <th> </th><th>1990</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_event_id,</span> </td>
                      </tr><tr>
                        <th> </th><th>1991</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_state,</span> </td>
                      </tr><tr>
                        <th> </th><th>1992</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_location_name,</span> </td>
                      </tr><tr>
                        <th> </th><th>1993</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_original_start_time,</span> </td>
                      </tr><tr>
                        <th> </th><th>1994</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_start_time,</span> </td>
                      </tr><tr>
                        <th> </th><th>1995</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_end_time)</span> </td>
                      </tr><tr>
                        <th> </th><th>1996</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VALUES ('.$this-&gt;db-&gt;escape($EventId).',</span> </td>
                      </tr><tr>
                        <th> </th><th>1997</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "draft",</span> </td>
                      </tr><tr>
                        <th> </th><th>1998</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "",</span> </td>
                      </tr><tr>
                        <th> </th><th>1999</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROM_UNIXTIME('.$this-&gt;db-&gt;escape($recurrence['start_time']).'),</span> </td>
                      </tr><tr>
                        <th> </th><th>2000</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROM_UNIXTIME('.$this-&gt;db-&gt;escape($recurrence['start_time']).'),</span> </td>
                      </tr><tr>
                        <th> </th><th>2001</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROM_UNIXTIME('.$this-&gt;db-&gt;escape($recurrence['end_time']).'))';</span> </td>
                      </tr><tr>
                        <th> </th><th>2002</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;db-&gt;query($sql_insert);</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>2003</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1872</th><th>2004</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1873</th><th>2005</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // restore</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1874</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($restore_list as $info) {</span> </td>
                      </tr><tr>
                        <th>1875</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list($occurrence, $duration) = $info;</span> </td>
                      </tr><tr>
                        <th>1876</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch ($occurrence['state']) {</span> </td>
                      </tr><tr>
                        <th>1877</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'deleted':</span> </td>
                      </tr><tr>
                        <th>1878</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'trashed':</span> </td>
                      </tr><tr>
                        <th>1879</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // draft</span> </td>
                      </tr><tr>
                        <th>1880</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_numeric($duration)) {</span> </td>
                      </tr><tr>
                        <th>1881</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'draft', array(),</span> </td>
                      </tr><tr>
                        <th>1882</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_occurrence_end_time = DATE_ADD(event_occurrence_start_time, INTERVAL '.(int)$duration.' SECOND)'</span> </td>
                      </tr><tr>
                        <th>1883</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th>1884</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th>1885</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'draft', array(),</span> </td>
                      </tr><tr>
                        <th>1886</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_occurrence_end_time = NULL'</span> </td>
                      </tr><tr>
                        <th>1887</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th>1888</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th>1889</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr>
                        <th>1890</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'cancelled':</span> </td>
                      </tr><tr>
                        <th>1891</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // publish</span> </td>
                      </tr><tr>
                        <th>1892</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_numeric($duration)) {</span> </td>
                      </tr><tr>
                        <th>1893</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'published', array(),</span> </td>
                      </tr><tr>
                        <th>1894</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_occurrence_end_time = DATE_ADD(event_occurrence_start_time, INTERVAL '.(int)$duration.' SECOND)'</span> </td>
                      </tr><tr>
                        <th>1895</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th>1896</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th>1897</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'published', array(),</span> </td>
                      </tr><tr>
                        <th>1898</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_occurrence_end_time = NULL'</span> </td>
                      </tr><tr>
                        <th>1899</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th>1900</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th>1901</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>2006</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($Changes['restore'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>2007</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Changes['restore'] as $info) {</span> </td>
                      </tr><tr>
                        <th> </th><th>2008</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list($occurrence, $duration) = $info;</span> </td>
                      </tr><tr>
                        <th> </th><th>2009</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch ($occurrence['state']) {</span> </td>
                      </tr><tr>
                        <th> </th><th>2010</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'deleted':</span> </td>
                      </tr><tr>
                        <th> </th><th>2011</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'trashed':</span> </td>
                      </tr><tr>
                        <th> </th><th>2012</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // draft</span> </td>
                      </tr><tr>
                        <th> </th><th>2013</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_numeric($duration)) {</span> </td>
                      </tr><tr>
                        <th> </th><th>2014</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'draft', array(),</span> </td>
                      </tr><tr>
                        <th> </th><th>2015</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_occurrence_end_time = DATE_ADD(event_occurrence_start_time, INTERVAL '.(int)$duration.' SECOND)'</span> </td>
                      </tr><tr>
                        <th> </th><th>2016</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>2017</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>2018</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'draft', array(),</span> </td>
                      </tr><tr>
                        <th> </th><th>2019</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_occurrence_end_time = NULL'</span> </td>
                      </tr><tr>
                        <th> </th><th>2020</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>2021</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>2022</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr>
                        <th> </th><th>2023</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'cancelled':</span> </td>
                      </tr><tr>
                        <th> </th><th>2024</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // publish</span> </td>
                      </tr><tr>
                        <th> </th><th>2025</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_numeric($duration)) {</span> </td>
                      </tr><tr>
                        <th> </th><th>2026</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'published', array(),</span> </td>
                      </tr><tr>
                        <th> </th><th>2027</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_occurrence_end_time = DATE_ADD(event_occurrence_start_time, INTERVAL '.(int)$duration.' SECOND)'</span> </td>
                      </tr><tr>
                        <th> </th><th>2028</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>2029</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>2030</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;OccurrenceChangeState($EventId, (int)$occurrence['id'], $occurrence['state'], 'published', array(),</span> </td>
                      </tr><tr>
                        <th> </th><th>2031</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'event_occurrence_end_time = NULL'</span> </td>
                      </tr><tr>
                        <th> </th><th>2032</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                      </tr><tr>
                        <th> </th><th>2033</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>2034</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>2035</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1902</th><th>2036</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1903</th><th>2037</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1904</th><th>2038</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // move</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1905</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($move_list as $info) {</span> </td>
                      </tr><tr>
                        <th>1906</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list($occurrence, $recurrence) = $info;</span> </td>
                      </tr><tr>
                        <th>1907</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // alter existing occurrences copying times + duration</span> </td>
                      </tr><tr>
                        <th>1908</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $start_time = strtotime($recurrence['day'].' '.$recurrence['time']);</span> </td>
                      </tr><tr>
                        <th>1909</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL !== $duration) {</span> </td>
                      </tr><tr>
                        <th>1910</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $end_time = strtotime($recurrence['duration'].' seconds', $start_time);</span> </td>
                      </tr><tr>
                        <th>1911</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th>1912</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $end_time = NULL;</span> </td>
                      </tr><tr>
                        <th>1913</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th>1914</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql = 'UPDATE event_occurrences</span> </td>
                      </tr><tr>
                        <th>1915</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET event_occurrence_start_time = FROM_UNIXTIME('.$start_time.'),</span> </td>
                      </tr><tr>
                        <th>1916</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_end_time = FROM_UNIXTIME('.$end_time.'),</span> </td>
                      </tr><tr>
                        <th>1917</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrences.event_occurrence_last_modified = CURRENT_TIMESTAMP()</span> </td>
                      </tr><tr>
                        <th>1918</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE event_occurrence_id = '.(int)$occurrence['id'];</span> </td>
                      </tr><tr>
                        <th>1919</th><th> </th><td class="l"><span>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddDumpMessage('sql',$sql);</span> </td>
                      </tr><tr>
                        <th>1920</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;db-&gt;query($sql);</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>2039</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($Changes['move'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>2040</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Changes['move'] as $info) {</span> </td>
                      </tr><tr>
                        <th> </th><th>2041</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list($occurrence, $recurrence) = $info;</span> </td>
                      </tr><tr>
                        <th> </th><th>2042</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // alter existing occurrences copying times + duration</span> </td>
                      </tr><tr>
                        <th> </th><th>2043</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $start_time = strtotime($recurrence['day'].' '.$recurrence['time']);</span> </td>
                      </tr><tr>
                        <th> </th><th>2044</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL !== $recurrence['duration']) {</span> </td>
                      </tr><tr>
                        <th> </th><th>2045</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $end_time = strtotime($recurrence['duration'].' seconds', $start_time);</span> </td>
                      </tr><tr>
                        <th> </th><th>2046</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>2047</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $end_time = NULL;</span> </td>
                      </tr><tr>
                        <th> </th><th>2048</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>2049</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql = 'UPDATE event_occurrences</span> </td>
                      </tr><tr>
                        <th> </th><th>2050</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET event_occurrence_start_time = FROM_UNIXTIME('.$start_time.'),</span> </td>
                      </tr><tr>
                        <th> </th><th>2051</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_end_time = FROM_UNIXTIME('.$end_time.'),</span> </td>
                      </tr><tr>
                        <th> </th><th>2052</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrences.event_occurrence_last_modified = CURRENT_TIMESTAMP()</span> </td>
                      </tr><tr>
                        <th> </th><th>2053</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE event_occurrence_id = '.(int)$occurrence['id'];</span> </td>
                      </tr><tr>
                        <th> </th><th>2054</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddDumpMessage('sql',$sql);</span> </td>
                      </tr><tr>
                        <th> </th><th>2055</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;db-&gt;query($sql);</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>2056</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1921</th><th>2057</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1922</th><th>2058</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L2073">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L2209">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>2073</th><th>2209</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; SELECT COUNT(*) INTO owned</span> </td>
                  </tr><tr>
                          <th>2074</th><th>2210</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROM event_occurrences</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>2075</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <del>INNER</del> JOIN event_entities</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>2211</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <ins>LEFT</ins> JOIN event_entities</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2076</th><th>2212</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_entities.event_entity_event_id</span> </td>
                  </tr><tr>
                          <th>2077</th><th>2213</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = event_occurrences.event_occurrence_event_id</span> </td>
                  </tr>
            </tbody><tbody class="rem">
                  <tr class="last first">
                          <th>2078</th><th> </th><td class="l"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND ' . $occurrence_query-&gt;ExpressionOwned('entity_id') . '</del> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2079</th><th>2214</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE&nbsp; &nbsp;event_occurrences.event_occurrence_id = occurrence_id</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>2080</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_occurrences.event_occurrence_event_id = event_id;</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>2215</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_occurrences.event_occurrence_event_id = event_id</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>2216</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND ' . $occurrence_query-&gt;ExpressionOwned('entity_id') . ';</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2081</th><th>2217</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; IF owned THEN</span> </td>
                  </tr><tr>
                          <th>2082</th><th>2218</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SELECT preactive.event_occurrence_id INTO preactive_id</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L2138">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L2274">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>2138</th><th>2274</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; function OccurrenceMovedraftCancel($EventId, $OccurrenceId)</span> </td>
                  </tr><tr>
                          <th>2139</th><th>2275</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>2276</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Add an exclude date first</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>2277</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2140</th><th>2278</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;OccurrenceMovedraftDelete($EventId, $OccurrenceId, 'cancelled');</span> </td>
                  </tr><tr>
                          <th>2141</th><th>2279</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L2151">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L2289">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>2151</th><th>2289</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; function OccurrencePublishedCancel($EventId, $OccurrenceId)</span> </td>
                  </tr><tr>
                          <th>2152</th><th>2290</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>2153</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;OccurrenceChangeState($EventId,$OccurrenceId, 'published','cancelled');</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>2291</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Add an exclude date first</span> </td>
                      </tr><tr>
                        <th> </th><th>2292</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $result = $this-&gt;OccurrenceChangeState($EventId,$OccurrenceId, 'published','cancelled');</span> </td>
                      </tr><tr>
                        <th> </th><th>2293</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($result) {</span> </td>
                      </tr><tr>
                        <th> </th><th>2294</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;EventAddExclusionDate($EventId, $OccurrenceId);</span> </td>
                      </tr><tr>
                        <th> </th><th>2295</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>2296</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $result;</span> </td>
                      </tr><tr>
                        <th> </th><th>2297</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>2298</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th> </th><th>2299</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Add an exclusion date to the recurrence of an event.</span> </td>
                      </tr><tr>
                        <th> </th><th>2300</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /**</span> </td>
                      </tr><tr>
                        <th> </th><th>2301</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $EventId&nbsp; &nbsp; &nbsp; int The id of the event.</span> </td>
                      </tr><tr>
                        <th> </th><th>2302</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $OccurrenceId int The id of the occurrence.</span> </td>
                      </tr><tr>
                        <th> </th><th>2303</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @note This only affects the rule of an event. Occurrences should be</span> </td>
                      </tr><tr>
                        <th> </th><th>2304</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; appropriately cancelled separately.</span> </td>
                      </tr><tr>
                        <th> </th><th>2305</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @note This is a wrapper for EventAddInclusionDate that sets @a $Exclude</span> </td>
                      </tr><tr>
                        <th> </th><th>2306</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; to true.</span> </td>
                      </tr><tr>
                        <th> </th><th>2307</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span> </td>
                      </tr><tr>
                        <th> </th><th>2308</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; function EventAddExclusionDate($EventId, $OccurrenceId)</span> </td>
                      </tr><tr>
                        <th> </th><th>2309</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                      </tr><tr>
                        <th> </th><th>2310</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;EventAddInclusionDate($EventId, $OccurrenceId, true);</span> </td>
                      </tr><tr>
                        <th> </th><th>2311</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>2312</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th> </th><th>2313</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /// Add an inclusion date to the recurrence of an event.</span> </td>
                      </tr><tr>
                        <th> </th><th>2314</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; /**</span> </td>
                      </tr><tr>
                        <th> </th><th>2315</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $EventId&nbsp; &nbsp; &nbsp; int&nbsp; The id of the event.</span> </td>
                      </tr><tr>
                        <th> </th><th>2316</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $OccurrenceId int&nbsp; The id of the occurrence.</span> </td>
                      </tr><tr>
                        <th> </th><th>2317</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param $Exclude&nbsp; &nbsp; &nbsp; bool Whether to exclude instead of include.</span> </td>
                      </tr><tr>
                        <th> </th><th>2318</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @note This only affects the rule of an event. Occurrences should be</span> </td>
                      </tr><tr>
                        <th> </th><th>2319</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; appropriately created separately.</span> </td>
                      </tr><tr>
                        <th> </th><th>2320</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span> </td>
                      </tr><tr>
                        <th> </th><th>2321</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; function EventAddInclusionDate($EventId, $OccurrenceId, $Exclude = false)</span> </td>
                      </tr><tr>
                        <th> </th><th>2322</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span> </td>
                      </tr><tr>
                        <th> </th><th>2323</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $occurrence_query = new EventOccurrenceQuery();</span> </td>
                      </tr><tr>
                        <th> </th><th>2324</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $sql_replace = '</span> </td>
                      </tr><tr>
                        <th> </th><th>2325</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REPLACE INTO event_dates (</span> </td>
                      </tr><tr>
                        <th> </th><th>2326</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_date_event_id,</span> </td>
                      </tr><tr>
                        <th> </th><th>2327</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_date_start,</span> </td>
                      </tr><tr>
                        <th> </th><th>2328</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_date_time_associated,</span> </td>
                      </tr><tr>
                        <th> </th><th>2329</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_date_duration,</span> </td>
                      </tr><tr>
                        <th> </th><th>2330</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_date_exclude</span> </td>
                      </tr><tr>
                        <th> </th><th>2331</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) SELECT</span> </td>
                      </tr><tr>
                        <th> </th><th>2332</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_id,</span> </td>
                      </tr><tr>
                        <th> </th><th>2333</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrence_start_time,</span> </td>
                      </tr><tr>
                        <th> </th><th>2334</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FALSE,</span> </td>
                      </tr><tr>
                        <th> </th><th>2335</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL,</span> </td>
                      </tr><tr>
                        <th> </th><th>2336</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '.$this-&gt;db-&gt;escape($Exclude).'</span> </td>
                      </tr><tr>
                        <th> </th><th>2337</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROM events</span> </td>
                      </tr><tr>
                        <th> </th><th>2338</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN event_entities</span> </td>
                      </tr><tr>
                        <th> </th><th>2339</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_entity_event_id = event_id</span> </td>
                      </tr><tr>
                        <th> </th><th>2340</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INNER JOIN event_occurrences</span> </td>
                      </tr><tr>
                        <th> </th><th>2341</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_occurrence_event_id = event_id</span> </td>
                      </tr><tr>
                        <th> </th><th>2342</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_occurrence_id = '.$this-&gt;db-&gt;Escape($OccurrenceId).'</span> </td>
                      </tr><tr>
                        <th> </th><th>2343</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE event_id = '.$this-&gt;db-&gt;escape($EventId).'</span> </td>
                      </tr><tr>
                        <th> </th><th>2344</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND ' . $occurrence_query-&gt;ExpressionOwned() . '</span> </td>
                      </tr><tr>
                        <th> </th><th>2345</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LIMIT 1';</span> </td>
                      </tr><tr>
                        <th> </th><th>2346</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;db-&gt;query($sql_replace);</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>2347</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;db-&gt;affected_rows();</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2154</th><th>2348</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>2155</th><th>2349</th><td class="l"><span></span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L2179">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L2373">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>2179</th><th>2373</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INNER JOIN events</span> </td>
                  </tr><tr>
                          <th>2180</th><th>2374</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_id = new_active.event_occurrence_event_id</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>2181</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <del>INNER</del> JOIN event_entities</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>2375</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <ins>LEFT</ins> JOIN event_entities</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2182</th><th>2376</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_entities.event_entity_event_id</span> </td>
                  </tr><tr>
                          <th>2183</th><th>2377</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = new_active.event_occurrence_event_id</span> </td>
                  </tr>
            </tbody><tbody class="rem">
                  <tr class="last first">
                          <th>2184</th><th> </th><td class="l"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND ' . $occurrence_query-&gt;ExpressionOwned() . '</del> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2185</th><th>2378</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LEFT JOIN event_occurrences AS old_active</span> </td>
                  </tr><tr>
                          <th>2186</th><th>2379</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; old_active.event_occurrence_id</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L2197">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L2390">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>2197</th><th>2390</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE&nbsp; &nbsp;new_active.event_occurrence_id = ?</span> </td>
                  </tr><tr>
                          <th>2198</th><th>2391</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;new_active.event_occurrence_event_id = ?</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="last first">
                          <th> </th><th>2392</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND ' . $occurrence_query-&gt;ExpressionOwned() . '</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2199</th><th>2393</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;(&nbsp; &nbsp; &nbsp; &nbsp;old_active.event_occurrence_state IS NULL</span> </td>
                  </tr><tr>
                          <th>2200</th><th>2394</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OR&nbsp; &nbsp; &nbsp; (&nbsp; &nbsp; &nbsp; &nbsp;old_active.event_occurrence_state = \'cancelled\'</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=2f47b71eb7d9ffd10913797a012cebf4f090a9bd#L2264">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/events_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L2458">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>2264</th><th>2458</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event_occurrences.event_occurrence_ends_late</span> </td>
                  </tr><tr>
                          <th>2265</th><th>2459</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROM event_occurrences</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>2266</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <del>INNER</del> JOIN event_entities</span> </td>
                      </tr>
                      <tr class="last">
                        <th> </th><th>2460</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <ins>LEFT</ins> JOIN event_entities</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2267</th><th>2461</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ON&nbsp; &nbsp; &nbsp; event_entities.event_entity_event_id</span> </td>
                  </tr><tr>
                          <th>2268</th><th>2462</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = event_occurrences.event_occurrence_event_id</span> </td>
                  </tr>
            </tbody><tbody class="rem">
                  <tr class="last first">
                          <th>2269</th><th> </th><td class="l"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND ' . $occurrence_query-&gt;ExpressionOwned() . '</del> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2270</th><th>2463</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE&nbsp; &nbsp;event_occurrences.event_occurrence_id = ?</span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>2271</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_occurrences.event_occurrence_event_id = ?';</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>2464</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp; &nbsp;event_occurrences.event_occurrence_event_id = ?</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>2465</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND ' . $occurrence_query-&gt;ExpressionOwned();</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>2272</th><th>2466</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $query = $this-&gt;db-&gt;query($sql_insert,array($OccurrenceId, $EventId));</span> </td>
                  </tr><tr>
                          <th>2273</th><th>2467</th><td class="l"><span></span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file5">
          <a title="Show the changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465 restricted to system/application/models/calendar/recurrence_model.php" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465/system/application/models/calendar/recurrence_model.php">system/application/models/calendar/recurrence_model.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 89f76c876dfa0a7801465a78a5776afc6a39f8df">
                    <a title="Show revision 89f76c876dfa0a7801465a78a5776afc6a39f8df of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/recurrence_model.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L1507">
                      r89f76</a>
                  </th>
                  <th title="Revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
                    <a title="Show revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/calendar/recurrence_model.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1507">
                      rc31b5</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>1507</th><th>1507</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($results[$array_name] as $date =&gt; $dates) {</span> </td>
                  </tr><tr>
                          <th>1508</th><th>1508</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($dates as $time =&gt; $duration) {</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1509</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL == $time) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>1510</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $time = $StartTime;</ins> </td>
                  </tr><tr>
                          <th> </th><th>1511</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset($results[$array_name][$date][NULL]);</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1512</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1509</th><th>1513</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NULL === $duration) {</span> </td>
                  </tr><tr>
                          <th>1510</th><th>1514</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $results[$array_name][$date][$time] = $Duration;</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file6">
          <a title="Show the changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465 restricted to system/application/models/subcontrollers/calendar_subcontroller.php" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465/system/application/models/subcontrollers/calendar_subcontroller.php">system/application/models/subcontrollers/calendar_subcontroller.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 89f76c876dfa0a7801465a78a5776afc6a39f8df">
                    <a title="Show revision 89f76c876dfa0a7801465a78a5776afc6a39f8df of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L979">
                      r89f76</a>
                  </th>
                  <th title="Revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
                    <a title="Show revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L979">
                      rc31b5</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>979</th><th>979</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                  </tr><tr>
                          <th>980</th><th>980</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $input_summary = $this-&gt;input-&gt;post($prefix.'_summary');</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="last first">
                          <th> </th><th>981</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list = NULL;</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>981</th><th>982</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (false !== $input_summary) {</span> </td>
                  </tr><tr>
                          <th>982</th><th>983</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $input_valid = true;</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L1014">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1015">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1014</th><th>1015</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $input['recur'] = $rset;</span> </td>
                  </tr><tr>
                          <th>1015</th><th>1016</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1016</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($_POST[$prefix.'_save']) &amp;&amp; $input_valid &amp;&amp; empty($errors)) {</span> </td>
                      </tr><tr>
                        <th>1017</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $messages = $this-&gt;mSource-&gt;CreateEvent($input);</span> </td>
                      </tr><tr>
                        <th>1018</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessages($messages);</span> </td>
                      </tr><tr>
                        <th>1019</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!array_key_exists('error', $messages) || empty($messages['error'])) {</span> </td>
                      </tr><tr>
                        <th>1020</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('success', 'Event created successfully.');</span> </td>
                      </tr><tr>
                        <th>1021</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return redirect($this-&gt;mPaths-&gt;Range(date('Y-M-j', $start)));</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1017</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($input_valid &amp;&amp; empty($errors)) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1018</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($_POST[$prefix.'_save'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1019</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $event = new CalendarEvent(-1, $this-&gt;mSource);</span> </td>
                      </tr><tr>
                        <th> </th><th>1020</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $changes_list = $this-&gt;mMainSource-&gt;GetEventRecurChanges($event, $rset);</span> </td>
                      </tr><tr>
                        <th> </th><th>1021</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (empty($changes_list)) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1022</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $_POST[$prefix.'_confirm']['confirm_btn'] = 'Confirm';</span> </td>
                      </tr><tr>
                        <th> </th><th>1023</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>1024</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list = $changes_list;</span> </td>
                      </tr><tr>
                        <th> </th><th>1025</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1026</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1027</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($_POST[$prefix.'_confirm']['confirm_btn'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1028</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $messages = $this-&gt;mSource-&gt;CreateEvent($input);</span> </td>
                      </tr><tr>
                        <th> </th><th>1029</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessages($messages);</span> </td>
                      </tr><tr>
                        <th> </th><th>1030</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!array_key_exists('error', $messages) || empty($messages['error'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1031</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('success', 'Event created successfully.');</span> </td>
                      </tr><tr>
                        <th> </th><th>1032</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return redirect($this-&gt;mPaths-&gt;Range(date('Y-M-j', $start)));</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1033</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1022</th><th>1034</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1023</th><th>1035</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L1058">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1070">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1058</th><th>1070</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'EventInfo' =&gt; $eventinfo,</span> </td>
                  </tr><tr>
                          <th>1059</th><th>1071</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Help' =&gt; $help_xhtml,</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1072</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'CanPublish' =&gt; $this-&gt;mMainSource-&gt;IsSupported('publish'),</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1073</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Create' =&gt; true,</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1060</th><th>1074</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1075</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_array($confirm_list)) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>1076</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $data['Confirms'] = $confirm_list;</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1077</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1061</th><th>1078</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($errors as $error) {</span> </td>
                  </tr><tr>
                          <th>1062</th><th>1079</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('error', $error['text']);</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L1299">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1316">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1299</th><th>1316</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1300</th><th>1317</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $input_summary = $this-&gt;input-&gt;post($prefix.'_summary');</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="last first">
                          <th> </th><th>1318</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list = NULL;</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1301</th><th>1319</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (false !== $input_summary) {</span> </td>
                  </tr><tr>
                          <th>1302</th><th>1320</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $input_valid = true;</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L1334">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1352">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1334</th><th>1352</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $input['recur'] = $rset;</span> </td>
                  </tr><tr>
                          <th>1335</th><th>1353</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1336</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($_POST[$prefix.'_save']) &amp;&amp; $input_valid &amp;&amp; empty($errors)) {</span> </td>
                      </tr><tr>
                        <th>1337</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Make the change</span> </td>
                      </tr><tr>
                        <th>1338</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /// @todo WARN about going live immmediately if applicable</span> </td>
                      </tr><tr>
                        <th>1339</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $messages = $this-&gt;mMainSource-&gt;AmmendEvent($event, $input);</span> </td>
                      </tr><tr>
                        <th>1340</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th>1341</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessages($messages);</span> </td>
                      </tr><tr>
                        <th>1342</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!array_key_exists('error', $messages) || empty($messages['error'])) {</span> </td>
                      </tr><tr>
                        <th>1343</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Success</span> </td>
                      </tr><tr>
                        <th>1344</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('success', 'Event updated');</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1354</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($input_valid &amp;&amp; empty($errors)) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1355</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($_POST[$prefix.'_save'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1356</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $changes_list = $this-&gt;mMainSource-&gt;GetEventRecurChanges($event, $rset);</span> </td>
                      </tr><tr>
                        <th> </th><th>1357</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (empty($changes_list)) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1358</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $_POST[$prefix.'_confirm']['confirm_btn'] = 'Confirm';</span> </td>
                      </tr><tr>
                        <th> </th><th>1359</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>1360</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $confirm_list = $changes_list;</span> </td>
                      </tr><tr>
                        <th> </th><th>1361</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1362</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr>
                        <th> </th><th>1363</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($_POST[$prefix.'_confirm']['confirm_btn'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1364</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Make the change</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1365</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $messages = $this-&gt;mMainSource-&gt;AmmendEvent($event, $input);</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1345</th><th>1366</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                  </tr>
            </tbody><tbody class="mod">
                      <tr class="first">
                        <th>1346</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // REDIRECT</span> </td>
                      </tr><tr>
                        <th>1347</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($occurrence_specified) {</span> </td>
                      </tr><tr>
                        <th>1348</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $path = $this-&gt;mPaths-&gt;OccurrenceInfo($found_occurrence);</span> </td>
                      </tr><tr>
                        <th>1349</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th>1350</th><th> </th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $path = $this-&gt;mPaths-&gt;EventInfo($event);</span> </td>
                      </tr>
                      <tr>
                        <th> </th><th>1367</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessages($messages);</span> </td>
                      </tr><tr>
                        <th> </th><th>1368</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!array_key_exists('error', $messages) || empty($messages['error'])) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1369</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Success</span> </td>
                      </tr><tr>
                        <th> </th><th>1370</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('success', 'Event updated');</span> </td>
                      </tr><tr>
                        <th> </th><th>1371</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span> </td>
                      </tr><tr>
                        <th> </th><th>1372</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // REDIRECT</span> </td>
                      </tr><tr>
                        <th> </th><th>1373</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($occurrence_specified) {</span> </td>
                      </tr><tr>
                        <th> </th><th>1374</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $path = $this-&gt;mPaths-&gt;OccurrenceInfo($found_occurrence);</span> </td>
                      </tr><tr>
                        <th> </th><th>1375</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span> </td>
                      </tr><tr>
                        <th> </th><th>1376</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $path = $this-&gt;mPaths-&gt;EventInfo($event);</span> </td>
                      </tr><tr>
                        <th> </th><th>1377</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                      </tr><tr class="last">
                        <th> </th><th>1378</th><td class="r"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return redirect($path.'/'.$tail);</span> </td>
                      </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1351</th><th>1379</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody><tbody class="rem">
                  <tr class="last first">
                          <th>1352</th><th> </th><td class="l"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return redirect($path.'/'.$tail);</del> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1353</th><th>1380</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr><tr>
                          <th>1354</th><th>1381</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L1389">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/models/subcontrollers/calendar_subcontroller.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L1416">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>1389</th><th>1416</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'EventInfo' =&gt; $eventinfo,</span> </td>
                  </tr><tr>
                          <th>1390</th><th>1417</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Help' =&gt; $help_xhtml,</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1418</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'CanPublish' =&gt; $this-&gt;mMainSource-&gt;IsSupported('publish'),</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1419</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Create' =&gt; false,</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1391</th><th>1420</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>1421</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_array($confirm_list)) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>1422</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $data['Confirms'] = $confirm_list;</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>1423</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>1392</th><th>1424</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($errors as $error) {</span> </td>
                  </tr><tr>
                          <th>1393</th><th>1425</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;messages-&gt;AddMessage('error', $error['text']);</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
      <li class="entry">
        <h2 id="file7">
          <a title="Show the changeset c31b59d2a4c5115d191c94a6a1c15a8a733cc465 restricted to system/application/views/calendar/event_edit.php" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465/system/application/views/calendar/event_edit.php">system/application/views/calendar/event_edit.php</a>
        </h2>
        <table class="inline" summary="Differences" cellspacing="0">
              <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
              <thead>
                <tr>
                  <th title="Revision 89f76c876dfa0a7801465a78a5776afc6a39f8df">
                    <a title="Show revision 89f76c876dfa0a7801465a78a5776afc6a39f8df of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event_edit.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L15">
                      r89f76</a>
                  </th>
                  <th title="Revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465">
                    <a title="Show revision c31b59d2a4c5115d191c94a6a1c15a8a733cc465 of this file in browser" href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event_edit.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L15">
                      rc31b5</a>
                  </th>
                  <th> </th>
                </tr>
              </thead>
            <tbody class="unmod">
                  <tr>
                          <th>15</th><th>15</th><td class="l"><span>&nbsp;* @param $EventCategories array[id =&gt; array('id'=&gt;,'name'=&gt;,'colour'=&gt;)]</span> </td>
                  </tr><tr>
                          <th>16</th><th>16</th><td class="l"><span>&nbsp;* @param $Help Help text array, indexed by title.</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>17</th><td class="r"><ins>&nbsp;* @param $Confirms Changes to be confirmed.</ins> </td>
                  </tr><tr>
                          <th> </th><th>18</th><td class="r"><ins>&nbsp;* @param $CanPublish bool Whether the user can publish this event.</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>19</th><td class="r"><ins>&nbsp;* @param $Create bool whether the event is new.</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>17</th><th>20</th><td class="l"><span>&nbsp;*</span> </td>
                  </tr><tr>
                          <th>18</th><th>21</th><td class="l"><span>&nbsp;* @todo Send information about what fields have changed, and only send the deltas</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event_edit.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L26">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event_edit.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L29">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>26</th><th>29</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; );</span> </td>
                  </tr><tr>
                          <th>27</th><th>30</th><td class="l"><span>}</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>31</th><td class="r"><ins></ins> </td>
                  </tr><tr>
                          <th> </th><th>32</th><td class="r"><ins>$confirm_types = array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>33</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; 'cancel'&nbsp; =&gt; array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>34</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description' =&gt; 'This occurrence is currently published and will be cancelled.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>35</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'descriptions' =&gt; 'These occurrences are currently published and will be cancelled.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>36</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; ),</ins> </td>
                  </tr><tr>
                          <th> </th><th>37</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; 'delete'&nbsp; =&gt; array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>38</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description' =&gt; 'This occurrences will be deleted.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>39</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'descriptions' =&gt; 'These occurrences will be deleted.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>40</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description_pub' =&gt; 'This occurrences is not published and will be deleted.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>41</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'descriptions_pub' =&gt; 'These occurrences are not published and will be deleted.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>42</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; ),</ins> </td>
                  </tr><tr>
                          <th> </th><th>43</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; 'move'&nbsp; &nbsp; =&gt; array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>44</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description' =&gt; 'The time and/or duration of this occurrences will be altered.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>45</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'descriptions' =&gt; 'The times and/or durations of these occurrences will be altered.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>46</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; ),</ins> </td>
                  </tr><tr>
                          <th> </th><th>47</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; 'restore' =&gt; array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>48</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description' =&gt; 'This occurrence is currently cancelled and will be restored.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>49</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'descriptions' =&gt; 'These occurrences are currently cancelled and will be restored.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>50</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; ),</ins> </td>
                  </tr><tr>
                          <th> </th><th>51</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; 'create' =&gt; array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>52</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description' =&gt; 'This occurrence will be created.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>53</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'descriptions' =&gt; 'These occurrences will be created.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>54</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description_pub' =&gt; 'This occurrences will be created. You can publish it now if you wish by selecting it.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>55</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'descriptions_pub' =&gt; 'These occurrences will be created. You can publish some now if you wish by selecting them.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>56</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'checkbox' =&gt; 'publish',</ins> </td>
                  </tr><tr>
                          <th> </th><th>57</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; ),</ins> </td>
                  </tr><tr>
                          <th> </th><th>58</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; 'draft' =&gt; array(</ins> </td>
                  </tr><tr>
                          <th> </th><th>59</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'description' =&gt; 'This occurrence is a draft. You can publish it now if you wish by selecting it.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>60</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'descriptions' =&gt; 'These occurrences are drafts. You can publish some now if you wish by selecting them.',</ins> </td>
                  </tr><tr>
                          <th> </th><th>61</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'checkbox' =&gt; 'publish',</ins> </td>
                  </tr><tr>
                          <th> </th><th>62</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; ),</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>63</th><td class="r"><ins>);</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>28</th><th>64</th><td class="l"><span></span> </td>
                  </tr><tr>
                          <th>29</th><th>65</th><td class="l"><span>// Reference arrays</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event_edit.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L203">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event_edit.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L239">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>203</th><th>239</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span> </td>
                  </tr><tr>
                          <th>204</th><th>240</th><td class="l"><span>&lt;/div&gt;</span> </td>
                  </tr>
            </tbody><tbody class="rem">
                  <tr class="last first">
                          <th>205</th><th> </th><td class="l"><del></del> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>206</th><th>241</th><td class="l"><span>&lt;div id="MainColumn"&gt;</span> </td>
                  </tr><tr>
                          <th>207</th><th>242</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;</span> </td>
                  </tr><tr>
                          <th>208</th><th>243</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;form class="form" method="post" action="&lt;?php echo(get_instance()-&gt;uri-&gt;uri_string()); ?&gt;"&gt;</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="first">
                          <th> </th><th>244</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;?php</ins> </td>
                  </tr><tr>
                          <th> </th><th>245</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (isset($Confirms) &amp;&amp; isset($Confirms['draft']) &amp;&amp; !$CanPublish) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>246</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset($Confirms['draft']);</ins> </td>
                  </tr><tr>
                          <th> </th><th>247</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (empty($Confirms)) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>248</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset($Confirms);</ins> </td>
                  </tr><tr>
                          <th> </th><th>249</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>250</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>251</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (isset($Confirms)) { ?&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>252</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="confirm_changes_div" class="BlueBox"&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>253</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h2&gt;Confirm changes&lt;/h2&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>254</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &lt;?php if (count($Confirms) == 1 &amp;&amp; isset($Confirms['draft'])) { ?&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>255</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;&nbsp; &nbsp; &nbsp;This event has one or more draft occurrences which are not</ins> </td>
                  </tr><tr>
                          <th> </th><th>256</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; publicly visible. You can publish some of them now if you</ins> </td>
                  </tr><tr>
                          <th> </th><th>257</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wish. &lt;/p&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>258</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &lt;?php } elseif (!$Create) { ?&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>259</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;&nbsp; &nbsp; &nbsp;The following changes will be made to your event. Please</ins> </td>
                  </tr><tr>
                          <th> </th><th>260</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; confirm that they are correct. &lt;p&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>261</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;&nbsp; &nbsp; &nbsp;&lt;em&gt;Occurrences which are in the past will</ins> </td>
                  </tr><tr>
                          <th> </th><th>262</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;strong&gt;not&lt;/strong&gt; be altered.&lt;/em&gt; &lt;/p&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>263</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &lt;?php } else { ?&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>264</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;&nbsp; &nbsp; &nbsp;The following changes will be made to your new event. Please</ins> </td>
                  </tr><tr>
                          <th> </th><th>265</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; confirm that they are correct. &lt;p&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>266</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &lt;?php } ?&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>267</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;?php</ins> </td>
                  </tr><tr>
                          <th> </th><th>268</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($confirm_types as $class =&gt; $class_info) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>269</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($Confirms[$class])) { ?&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>270</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="confirm_changes_&lt;?php echo($class); ?&gt;_div"&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>271</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3&gt;&lt;?php echo(ucfirst($class)); ?&gt; occurrences&lt;/h3&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>272</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;&lt;em&gt;&lt;?php</ins> </td>
                  </tr><tr>
                          <th> </th><th>273</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // Get the description key based on plurality and publishability</ins> </td>
                  </tr><tr>
                          <th> </th><th>274</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $description_key = 'description';</ins> </td>
                  </tr><tr>
                          <th> </th><th>275</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (count($Confirms[$class]) &gt; 1) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>276</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $description_key .= 's';</ins> </td>
                  </tr><tr>
                          <th> </th><th>277</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>278</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if ($CanPublish &amp;&amp; isset($confirm_types[$class][$description_key.'_pub'])) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>279</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $description_key .= '_pub';</ins> </td>
                  </tr><tr>
                          <th> </th><th>280</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>281</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; echo($confirm_types[$class][$description_key]);</ins> </td>
                  </tr><tr>
                          <th> </th><th>282</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ?&gt;&lt;/em&gt;&lt;/p&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>283</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;?php foreach ($Confirms[$class] as $id =&gt; $confirm_occ) { ?&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>284</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="eved_confirm_&lt;?php echo($class); ?&gt;_list"&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>285</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="&lt;?php echo($class); ?&gt;"&gt;&lt;?php</ins> </td>
                  </tr><tr>
                          <th> </th><th>286</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // Description as label or div tag</ins> </td>
                  </tr><tr>
                          <th> </th><th>287</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $show_checkbox = $CanPublish &amp;&amp; isset($confirm_types[$class]['checkbox']);</ins> </td>
                  </tr><tr>
                          <th> </th><th>288</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $description_tag_type = $show_checkbox ? 'label' : 'div';</ins> </td>
                  </tr><tr>
                          <th> </th><th>289</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; echo("&lt;$description_tag_type class=\"description\"&gt;");</ins> </td>
                  </tr><tr>
                          <th> </th><th>290</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // Show a checkbox if necessary</ins> </td>
                  </tr><tr>
                          <th> </th><th>291</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if ($show_checkbox) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>292</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $checkbox_id = 'eved_confirm_'.$class.'_'.$confirm_types[$class]['checkbox'].'_'.$confirm_occ['day'];</ins> </td>
                  </tr><tr>
                          <th> </th><th>293</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $checkbox_name = 'eved_confirm['.$class.'_'.$confirm_types[$class]['checkbox'].']['.$confirm_occ['day'].']';</ins> </td>
                  </tr><tr>
                          <th> </th><th>294</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo('&lt;input id="'.$checkbox_id.'" name="'.$checkbox_name.'" type="checkbox" /&gt;');</ins> </td>
                  </tr><tr>
                          <th> </th><th>295</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>296</th><td class="r"><ins></ins> </td>
                  </tr><tr>
                          <th> </th><th>297</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // Display the date and time of the occurrence</ins> </td>
                  </tr><tr>
                          <th> </th><th>298</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $ts = $confirm_occ['start_time'];</ins> </td>
                  </tr><tr>
                          <th> </th><th>299</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $atime = new Academic_time($ts);</ins> </td>
                  </tr><tr>
                          <th> </th><th>300</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; echo(date('l, j',$ts));&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // DAY MONTHDAY</ins> </td>
                  </tr><tr>
                          <th> </th><th>301</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; echo('&lt;sup&gt;'.date('S',$ts).'&lt;/sup&gt; '); // &lt;sup&gt;NTH&lt;/sup&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>302</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; echo(date('F Y',$ts));&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// MONTH YEAR</ins> </td>
                  </tr><tr>
                          <th> </th><th>303</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; echo(' at '.$atime-&gt;Format('%T'));&nbsp; &nbsp; &nbsp;// at TIME</ins> </td>
                  </tr><tr>
                          <th> </th><th>304</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // Show simplistic changes to the time</ins> </td>
                  </tr><tr>
                          <th> </th><th>305</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (isset($confirm_occ['new_start_time'])) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>306</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($confirm_occ['new_start_time'] != $confirm_occ['start_time']) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>307</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $new_atime = new Academic_time($confirm_occ['new_start_time']);</ins> </td>
                  </tr><tr>
                          <th> </th><th>308</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo(' (moving to &lt;strong&gt;'.$new_atime-&gt;Format('%T').'&lt;/strong&gt;)');</ins> </td>
                  </tr><tr>
                          <th> </th><th>309</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ($confirm_occ['new_end_time'] != $confirm_occ['end_time']) {</ins> </td>
                  </tr><tr>
                          <th> </th><th>310</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $new_atime = new Academic_time($confirm_occ['new_end_time']);</ins> </td>
                  </tr><tr>
                          <th> </th><th>311</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo(' (ending &lt;strong&gt;'.$new_atime-&gt;Format('%T').'&lt;/strong&gt;)');</ins> </td>
                  </tr><tr>
                          <th> </th><th>312</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>313</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>314</th><td class="r"><ins></ins> </td>
                  </tr><tr>
                          <th> </th><th>315</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // close the description tag</ins> </td>
                  </tr><tr>
                          <th> </th><th>316</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; echo("&lt;/$description_tag_type&gt;");</ins> </td>
                  </tr><tr>
                          <th> </th><th>317</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ?&gt;&lt;/div&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>318</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>319</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;?php } ?&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>320</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>321</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;?php</ins> </td>
                  </tr><tr>
                          <th> </th><th>322</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins> </td>
                  </tr><tr>
                          <th> </th><th>323</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } ?&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>324</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;fieldset&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>325</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="submit" class="button" id="eved_confirm_edit_btn" name="eved_confirm[edit_btn]" onclick="document.getElementById('main_edit_divs').style.display='inline'; document.getElementById('confirm_changes_div').style.display='none'; return false;" value="Make further changes" /&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>326</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="submit" class="button" name="eved_confirm[confirm_btn]" value="Confirm changes" /&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>327</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/fieldset&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>328</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</ins> </td>
                  </tr><tr>
                          <th> </th><th>329</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;?php } ?&gt;</ins> </td>
                  </tr><tr class="last">
                          <th> </th><th>330</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="main_edit_divs" style="display:&lt;?php echo(isset($Confirms) ? 'none' : 'block'); ?&gt;;"&gt;</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>209</th><th>331</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="BlueBox"&gt;</span> </td>
                  </tr><tr>
                          <th>210</th><th>332</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="hidden" id="prefix" name="prefix" value="eved" /&gt;</span> </td>
                  </tr>
            </tbody>
              <tbody class="skipped">
                <tr>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event_edit.php?rev=89f76c876dfa0a7801465a78a5776afc6a39f8df#L610">…</a></th>
                  <th><a href="http://dev2.theyorker.co.uk/trac/browser/system/application/views/calendar/event_edit.php?rev=c31b59d2a4c5115d191c94a6a1c15a8a733cc465#L732">…</a></th>
                  <td> </td>
                </tr>
              </tbody>
            <tbody class="unmod">
                  <tr>
                          <th>610</th><th>732</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/fieldset&gt;</span> </td>
                  </tr><tr>
                          <th>611</th><th>733</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span> </td>
                  </tr>
            </tbody><tbody class="add">
                  <tr class="last first">
                          <th> </th><th>734</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</ins> </td>
                  </tr>
            </tbody><tbody class="unmod">
                  <tr>
                          <th>612</th><th>735</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/form&gt;</span> </td>
                  </tr><tr>
                          <th>613</th><th>736</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;?php</span> </td>
                  </tr>
            </tbody>
        </table>
      </li>
  </ul>
</div>
      </div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465?format=diff&new=c31b59d2a4c5115d191c94a6a1c15a8a733cc465" class="diff">Unified Diff</a>
        </li><li class="last">
          <a rel="nofollow" href="http://dev2.theyorker.co.uk/trac/changeset/c31b59d2a4c5115d191c94a6a1c15a8a733cc465?format=zip&new=c31b59d2a4c5115d191c94a6a1c15a8a733cc465" class="zip">Zip Archive</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">
        Powered by <a href="../about.html"><strong>Trac 0.11.1</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.
      </p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>